{% extends "base.html" %}

{% block title %}{{ workflow.name }} - The Combine{% endblock %}

{% block page_title %}{{ workflow.name }}{% endblock %}

{% block header_actions %}
<form action="/workflows/{{ workflow.workflow_id }}/start" method="post" class="start-form">
    <button type="submit" class="btn btn-primary"
            hx-post="/workflows/{{ workflow.workflow_id }}/start"
            hx-vals='{"project_id": "proj_new"}'
            hx-target="body">
        Start Workflow
    </button>
</form>
{% endblock %}

{% block content %}
<div class="workflow-detail">
    <section class="card workflow-info">
        <h3 class="card-title">Overview</h3>
        <p class="workflow-description">{{ workflow.description }}</p>
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">Version</span>
                <span class="info-value">{{ workflow.version }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Scope Type</span>
                <span class="info-value">{{ workflow.scope_type }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Document Type</span>
                <span class="info-value">{{ workflow.document_type }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Nodes</span>
                <span class="info-value">{{ workflow.nodes|length }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Edges</span>
                <span class="info-value">{{ workflow.edges|length }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Entry Nodes</span>
                <span class="info-value">{{ workflow.entry_node_ids|join(', ') }}</span>
            </div>
        </div>
    </section>

    <section class="card workflow-nodes">
        <h3 class="card-title">Nodes</h3>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Node ID</th>
                    <th>Type</th>
                    <th>Description</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                {% for node in workflow.nodes %}
                <tr>
                    <td><code>{{ node.node_id }}</code></td>
                    <td><span class="badge">{{ node.type.value }}</span></td>
                    <td>{{ node.description }}</td>
                    <td>
                        {% if node.produces %}
                        <span class="badge badge-info">produces: {{ node.produces }}</span>
                        {% endif %}
                        {% if node.terminal_outcome %}
                        <span class="badge {% if node.terminal_outcome == 'stabilized' %}badge-success{% else %}badge-warning{% endif %}">{{ node.terminal_outcome }}</span>
                        {% endif %}
                        {% if node.requires_qa %}
                        <span class="badge badge-muted">QA</span>
                        {% endif %}
                        {% if node.task_ref %}
                        <code>{{ node.task_ref }}</code>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <section class="card workflow-edges">
        <h3 class="card-title">Edges</h3>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Edge ID</th>
                    <th>From</th>
                    <th>To</th>
                    <th>Outcome</th>
                    <th>Kind</th>
                </tr>
            </thead>
            <tbody>
                {% for edge in workflow.edges %}
                <tr>
                    <td><code>{{ edge.edge_id }}</code></td>
                    <td><code>{{ edge.from_node_id }}</code></td>
                    <td>
                        {% if edge.to_node_id %}
                        <code>{{ edge.to_node_id }}</code>
                        {% else %}
                        <span class="badge badge-muted">non-advancing</span>
                        {% endif %}
                    </td>
                    <td>{{ edge.outcome }}{% if edge.label %} ({{ edge.label }}){% endif %}</td>
                    <td><span class="badge">{{ edge.kind.value }}</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
</div>
{% endblock %}
