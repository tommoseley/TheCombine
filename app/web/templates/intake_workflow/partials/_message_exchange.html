<!-- Message exchange partial - user message + assistant response -->

<!-- User message (only if not already shown optimistically) -->
{% if user_message %}
<div class="flex items-start space-x-3 justify-end">
    <div class="flex-1 flex justify-end">
        <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-4 max-w-prose">
            <p class="text-gray-900 dark:text-white whitespace-pre-wrap">{{ user_message }}</p>
        </div>
    </div>
    <div class="w-8 h-8 bg-gray-400 rounded-full flex items-center justify-center flex-shrink-0">
        <span class="text-white text-sm font-bold">U</span>
    </div>
</div>
{% endif %}

<!-- Assistant response -->
{% if assistant_response %}
<div class="flex items-start space-x-3">
    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
        <span class="text-white text-sm font-bold">C</span>
    </div>
    <div class="flex-1">
        <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4 max-w-prose">
            <p class="text-gray-900 dark:text-white">{{ assistant_response }}</p>
        </div>
    </div>
</div>
{% endif %}

<!-- Inline choices if available -->
{% if pending_choices and is_paused %}
<div class="flex items-start space-x-3">
    <div class="w-8 h-8"></div>
    <div class="flex-1">
        <div class="flex flex-wrap gap-2 mt-2">
            {% for choice in pending_choices %}
            <button
                type="button"
                hx-post="/intake/{{ execution_id }}/choice"
                hx-vals='{"choice": "{{ choice }}"}'
                hx-target="#messages"
                hx-swap="beforeend scroll:#messages:bottom"
                class="px-3 py-1.5 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
                {{ choice|replace('_', ' ')|title }}
            </button>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- Completion state -->
{% if is_completed %}
<script>
    // Redirect to show completion banner (use specific execution URL, not reload)
    window.location.href = '/intake/{{ execution_id }}';
</script>
{% endif %}
