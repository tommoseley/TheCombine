{#
  Project Detail Content Partial (ADR-007 Updated)
  
  Main content area for project detail page.
  Includes document-centric sidebar and workspace.
  
  Required context:
    - request: FastAPI request
    - project: Project object
    - document_statuses: List[DocumentStatus] from DocumentStatusService
    - active_doc_type: Currently selected document type (optional)
    - active_document: Currently selected Document (optional)
    - doc_status: DocumentStatus for active document (optional)
#}

<div class="flex h-full">
  
  {# ===== LEFT SIDEBAR: Document Status List ===== #}
  <aside class="w-64 flex-shrink-0 border-r border-gray-200 bg-gray-50 overflow-y-auto">
    <div class="p-4">
      
      {# Project Header #}
      <div class="mb-4">
        <h2 class="text-sm font-semibold text-gray-900 truncate" title="{{ project.name }}">
          {{ project.name }}
        </h2>
        {% if project.short_id %}
        <p class="text-xs text-gray-500">{{ project.short_id }}</p>
        {% endif %}
      </div>
      
      {# Document Types Section #}
      <div class="mb-4">
        <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wider mb-2">
          Documents
        </h3>
        {% include "components/sidebar/document_status_list.html" %}
      </div>
      
    </div>
  </aside>
  
  {# ===== CENTER: Main Workspace ===== #}
  <main class="flex-1 overflow-y-auto" id="main-content">
    <div class="max-w-4xl mx-auto px-6 py-6">
      
      {% if active_doc_type and doc_status %}
        {# ===== Document Detail View ===== #}
        
        {# Breadcrumb #}
        <nav class="mb-4">
          <ol class="flex items-center gap-2 text-sm text-gray-500">
            <li>
              <a href="/ui/projects" 
                 class="hover:text-gray-700"
                 hx-get="/ui/projects"
                 hx-target="#main-content"
                 hx-push-url="true">
                Projects
              </a>
            </li>
            <li><i data-lucide="chevron-right" class="w-4 h-4"></i></li>
            <li>
              <a href="/ui/projects/{{ project.id }}" 
                 class="hover:text-gray-700"
                 hx-get="/ui/projects/{{ project.id }}"
                 hx-target="#main-content"
                 hx-push-url="true">
                {{ project.name }}
              </a>
            </li>
            <li><i data-lucide="chevron-right" class="w-4 h-4"></i></li>
            <li class="text-gray-900 font-medium">{{ doc_status.title }}</li>
          </ol>
        </nav>
        
        {# Document Header #}
        <header class="mb-6">
          <div class="flex items-start justify-between">
            <div class="flex items-center gap-3">
              <div class="p-2 bg-gray-100 rounded-lg">
                <i data-lucide="{{ doc_status.icon }}" class="w-6 h-6 text-gray-600"></i>
              </div>
              <div>
                <h1 class="text-2xl font-semibold text-gray-900">
                  {{ doc_status.title }}
                </h1>
                {% if doc_status.subtitle %}
                <p class="text-sm text-gray-500 mt-0.5">{{ doc_status.subtitle }}</p>
                {% endif %}
              </div>
            </div>
            
            {# Status Badge #}
            <div class="flex items-center gap-2">
              {% if doc_status.readiness == 'ready' %}
                <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full 
                             text-xs font-medium bg-green-100 text-green-700">
                  <i data-lucide="check-circle" class="w-3.5 h-3.5"></i>
                  Ready
                </span>
              {% elif doc_status.readiness == 'stale' %}
                <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full 
                             text-xs font-medium bg-amber-100 text-amber-700">
                  <i data-lucide="alert-triangle" class="w-3.5 h-3.5"></i>
                  Stale
                </span>
              {% elif doc_status.readiness == 'blocked' %}
                <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full 
                             text-xs font-medium bg-red-100 text-red-700">
                  <i data-lucide="x-circle" class="w-3.5 h-3.5"></i>
                  Blocked
                </span>
              {% elif doc_status.readiness == 'waiting' %}
                <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full 
                             text-xs font-medium bg-gray-100 text-gray-600">
                  <i data-lucide="clock" class="w-3.5 h-3.5"></i>
                  Waiting
                </span>
              {% endif %}
              
              {% if doc_status.acceptance_state == 'accepted' %}
                <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full 
                             text-xs font-medium bg-green-100 text-green-700">
                  <i data-lucide="badge-check" class="w-3.5 h-3.5"></i>
                  Accepted
                </span>
              {% elif doc_status.acceptance_state == 'needs_acceptance' %}
                <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full 
                             text-xs font-medium bg-yellow-100 text-yellow-700">
                  <i data-lucide="circle-dot" class="w-3.5 h-3.5"></i>
                  Needs Acceptance
                </span>
              {% elif doc_status.acceptance_state == 'rejected' %}
                <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full 
                             text-xs font-medium bg-red-100 text-red-700">
                  <i data-lucide="x-octagon" class="w-3.5 h-3.5"></i>
                  Rejected
                </span>
              {% endif %}
            </div>
          </div>
        </header>
        
        {# Action Buttons #}
        <section class="mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
          {% include "components/document_actions.html" %}
        </section>
        
        {# Document Content #}
        {% if active_document %}
        <section class="prose prose-gray max-w-none">
          <div class="bg-white rounded-lg border border-gray-200 p-6">
            {# Render document content based on type #}
            {% if active_document.content %}
              {% include "components/document_content.html" %}
            {% else %}
              <p class="text-gray-500 italic">No content available.</p>
            {% endif %}
          </div>
          
          {# Document Metadata #}
          <div class="mt-4 text-xs text-gray-400 flex items-center gap-4">
            <span>Version {{ active_document.version }}</span>
            {% if active_document.created_at %}
            <span>Created {{ active_document.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
            {% endif %}
            {% if active_document.accepted_at %}
            <span>Accepted by {{ active_document.accepted_by }} on {{ active_document.accepted_at.strftime('%Y-%m-%d') }}</span>
            {% endif %}
          </div>
        </section>
        {% else %}
          {# No document exists yet #}
          <section class="text-center py-12">
            <div class="mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
              <i data-lucide="{{ doc_status.icon }}" class="w-8 h-8 text-gray-400"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">
              No {{ doc_status.title }} Yet
            </h3>
            {% if doc_status.readiness == 'waiting' %}
            <p class="text-gray-500 mb-4">
              Prerequisites are complete. Click <strong>Generate</strong> to create this document.
            </p>
            {% elif doc_status.readiness == 'blocked' %}
            <p class="text-gray-500 mb-4">
              Complete the following first: {{ doc_status.missing_inputs | join(', ') }}
            </p>
            {% endif %}
          </section>
        {% endif %}
        
      {% else %}
        {# ===== Project Overview (no document selected) ===== #}
        
        {# Breadcrumb #}
        <nav class="mb-4">
          <ol class="flex items-center gap-2 text-sm text-gray-500">
            <li>
              <a href="/ui/projects" 
                 class="hover:text-gray-700"
                 hx-get="/ui/projects"
                 hx-target="#main-content"
                 hx-push-url="true">
                Projects
              </a>
            </li>
            <li><i data-lucide="chevron-right" class="w-4 h-4"></i></li>
            <li class="text-gray-900 font-medium">{{ project.name }}</li>
          </ol>
        </nav>
        
        {# Project Header #}
        <header class="mb-6">
          <h1 class="text-2xl font-semibold text-gray-900">{{ project.name }}</h1>
          {% if project.description %}
          <p class="text-gray-600 mt-2">{{ project.description }}</p>
          {% endif %}
        </header>
        
        {# Project Status Summary #}
        <section class="grid grid-cols-4 gap-4 mb-8">
          {% set ready_count = document_statuses | selectattr('readiness', 'equalto', 'ready') | list | length %}
          {% set stale_count = document_statuses | selectattr('readiness', 'equalto', 'stale') | list | length %}
          {% set blocked_count = document_statuses | selectattr('readiness', 'equalto', 'blocked') | list | length %}
          {% set waiting_count = document_statuses | selectattr('readiness', 'equalto', 'waiting') | list | length %}
          
          <div class="bg-green-50 rounded-lg p-4 border border-green-100">
            <div class="text-2xl font-semibold text-green-700">{{ ready_count }}</div>
            <div class="text-sm text-green-600">Ready</div>
          </div>
          <div class="bg-amber-50 rounded-lg p-4 border border-amber-100">
            <div class="text-2xl font-semibold text-amber-700">{{ stale_count }}</div>
            <div class="text-sm text-amber-600">Stale</div>
          </div>
          <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
            <div class="text-2xl font-semibold text-gray-700">{{ waiting_count }}</div>
            <div class="text-sm text-gray-600">Waiting</div>
          </div>
          <div class="bg-red-50 rounded-lg p-4 border border-red-100">
            <div class="text-2xl font-semibold text-red-700">{{ blocked_count }}</div>
            <div class="text-sm text-red-600">Blocked</div>
          </div>
        </section>
        
        {# Quick Actions #}
        <section>
          <h2 class="text-lg font-medium text-gray-900 mb-4">Next Steps</h2>
          <div class="space-y-3">
            {% for doc_status in document_statuses %}
              {% if doc_status.readiness == 'waiting' %}
              <div class="flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-colors">
                <div class="flex items-center gap-3">
                  <i data-lucide="{{ doc_status.icon }}" class="w-5 h-5 text-gray-400"></i>
                  <span class="text-gray-700">{{ doc_status.title }}</span>
                  <span class="text-xs text-gray-500">Ready to generate</span>
                </div>
                <button type="button"
                        class="inline-flex items-center gap-1.5 px-3 py-1.5 
                               text-sm font-medium rounded-md
                               bg-blue-600 text-white hover:bg-blue-700"
                        hx-post="/ui/projects/{{ project.id }}/documents/{{ doc_status.doc_type_id }}/build"
                        hx-target="#main-content">
                  <i data-lucide="play" class="w-4 h-4"></i>
                  Generate
                </button>
              </div>
              {% elif doc_status.acceptance_state == 'needs_acceptance' %}
              <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                <div class="flex items-center gap-3">
                  <i data-lucide="{{ doc_status.icon }}" class="w-5 h-5 text-yellow-600"></i>
                  <span class="text-gray-700">{{ doc_status.title }}</span>
                  <span class="text-xs text-yellow-600">Needs acceptance</span>
                </div>
                <a href="/ui/projects/{{ project.id }}/documents/{{ doc_status.doc_type_id }}"
                   class="inline-flex items-center gap-1.5 px-3 py-1.5 
                          text-sm font-medium rounded-md
                          bg-yellow-100 text-yellow-700 hover:bg-yellow-200"
                   hx-get="/ui/projects/{{ project.id }}/documents/{{ doc_status.doc_type_id }}"
                   hx-target="#main-content"
                   hx-push-url="true">
                  <i data-lucide="eye" class="w-4 h-4"></i>
                  Review
                </a>
              </div>
              {% endif %}
            {% endfor %}
          </div>
        </section>
        
      {% endif %}
      
    </div>
  </main>
  
</div>

{# Modal Container #}
<div id="modal-container"></div>

{# Loading Indicator #}
<div id="loading-indicator" class="htmx-indicator fixed top-4 right-4 z-50">
  <div class="flex items-center gap-2 px-3 py-2 bg-white rounded-lg shadow-lg border border-gray-200">
    <i data-lucide="loader-2" class="w-4 h-4 text-blue-600 animate-spin"></i>
    <span class="text-sm text-gray-600">Loading...</span>
  </div>
</div>