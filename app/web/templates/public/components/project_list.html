<!-- components/project_list.html -->
<!-- Simplified project list - click to launch floor -->

{% if projects and projects|length > 0 %}
    {# Separate active and archived projects #}
    {% set active_projects = [] %}
    {% set archived_projects = [] %}
    {% for project in projects %}
        {% if project.is_archived %}
            {% set _ = archived_projects.append(project) %}
        {% else %}
            {% set _ = active_projects.append(project) %}
        {% endif %}
    {% endfor %}

    {# Active Projects - Each is a launcher to the floor #}
    <div class="space-y-1 py-2">
        {% for project in active_projects %}
        <a
            href="/production?project_id={{ project.id }}"
            hx-get="/production?project_id={{ project.id }}"
            hx-target="#main-content"
            hx-push-url="true"
            class="project-link flex items-center gap-3 px-3 py-2.5 mx-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors group"
            data-project-id="{{ project.id }}">

            <!-- Project Icon -->
            <i data-lucide="{{ project.icon | default('factory') }}" class="w-5 h-5 text-gray-500 dark:text-gray-400 group-hover:text-violet-600 dark:group-hover:text-violet-400 flex-shrink-0"></i>

            <!-- Project Name -->
            <span class="text-sm font-medium text-gray-900 dark:text-gray-100 truncate flex-1 group-hover:text-violet-600 dark:group-hover:text-violet-400">
                {{ project.name }}
            </span>

            <!-- Arrow indicator -->
            <i data-lucide="chevron-right" class="w-4 h-4 text-gray-300 dark:text-gray-600 group-hover:text-violet-400 flex-shrink-0"></i>
        </a>
        {% endfor %}
    </div>

    {# Archived Projects Section #}
    {% if archived_projects|length > 0 %}
    <div class="mt-4 pt-3 border-t border-gray-200 dark:border-gray-700">
        <button
            type="button"
            onclick="toggleArchivedSection()"
            class="w-full px-3 py-2 flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors rounded-lg group"
            id="archived-section-toggle">
            <i data-lucide="chevron-right" id="archived-chevron" class="w-4 h-4 text-gray-400 dark:text-gray-500 transition-transform"></i>
            <i data-lucide="archive" class="w-4 h-4 text-gray-400 dark:text-gray-500"></i>
            <span class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">Archived</span>
            <span class="ml-auto text-xs text-gray-400 dark:text-gray-500 font-medium">{{ archived_projects|length }}</span>
        </button>
    </div>

    <div id="archived-projects-list" class="hidden space-y-1 py-2">
        {% for project in archived_projects %}
        <a
            href="/production?project_id={{ project.id }}"
            hx-get="/production?project_id={{ project.id }}"
            hx-target="#main-content"
            hx-push-url="true"
            class="project-link flex items-center gap-3 px-3 py-2 mx-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors opacity-60 group"
            data-project-id="{{ project.id }}">
            <i data-lucide="{{ project.icon | default('factory') }}" class="w-5 h-5 text-gray-400 dark:text-gray-500 flex-shrink-0"></i>
            <span class="text-sm text-gray-600 dark:text-gray-400 truncate flex-1">{{ project.name }}</span>
            <i data-lucide="lock" class="w-4 h-4 text-amber-500 flex-shrink-0"></i>
        </a>
        {% endfor %}
    </div>
    {% endif %}

{% else %}
<div class="p-4 text-center">
    <i data-lucide="factory" class="w-8 h-8 text-gray-300 dark:text-gray-600 mx-auto mb-2"></i>
    <p class="text-sm text-gray-500 dark:text-gray-400">No projects yet</p>
    <a
        href="/projects/new"
        hx-get="/projects/new"
        hx-target="#main-content"
        hx-push-url="true"
        class="text-sm text-violet-600 dark:text-violet-400 hover:text-violet-800 dark:hover:text-violet-300 mt-2 inline-block">
        Create your first project
    </a>
</div>
{% endif %}

<script>
function toggleArchivedSection() {
    const list = document.getElementById('archived-projects-list');
    const chevron = document.getElementById('archived-chevron');
    const isHidden = list.classList.contains('hidden');

    if (isHidden) {
        list.classList.remove('hidden');
        chevron.setAttribute('data-lucide', 'chevron-down');
        localStorage.setItem('archivedProjectsExpanded', 'true');
    } else {
        list.classList.add('hidden');
        chevron.setAttribute('data-lucide', 'chevron-right');
        localStorage.setItem('archivedProjectsExpanded', 'false');
    }

    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const expanded = localStorage.getItem('archivedProjectsExpanded') === 'true';
    if (expanded) {
        const list = document.getElementById('archived-projects-list');
        const chevron = document.getElementById('archived-chevron');
        if (list && chevron) {
            list.classList.remove('hidden');
            chevron.setAttribute('data-lucide', 'chevron-down');
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }
    }
});
</script>
