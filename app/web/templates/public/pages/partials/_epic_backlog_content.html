{# Epic Backlog Content - ADR-030 ViewModel-driven #}
{# Templates must only access vm.* (no document, content, or ORM fields) #}

<div class="p-6 max-w-7xl mx-auto">
    {% set doc_title = "Epic Backlog" %}
    {% set doc_icon = "layers" %}
    {% set doc_description = vm.subtitle if vm.subtitle else "Project epics and work streams" %}
    {% include "public/pages/partials/_document_header.html" %}

    {% if vm.exists and vm.sections %}
    
    <!-- Epic Set Summary -->
    {% if vm.epic_set_summary %}
    <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 mb-8">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <i data-lucide="file-text" class="w-5 h-5 text-gray-600 dark:text-gray-400"></i>
                <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-50">Epic Set Summary</h2>
            </div>
            <div class="flex gap-2">
                <span class="flex items-center gap-1.5 px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-sm font-medium">
                    <i data-lucide="rocket" class="w-3.5 h-3.5 text-violet-600 dark:text-violet-500"></i>
                    {{ vm.mvp_count }} MVP
                </span>
                <span class="flex items-center gap-1.5 px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-full text-sm font-medium">
                    <i data-lucide="calendar" class="w-3.5 h-3.5"></i>
                    {{ vm.later_count }} Later
                </span>
            </div>
        </div>
        <div class="p-6 space-y-4">
            {% if vm.epic_set_summary.overall_intent %}
            <div class="border-l-4 border-violet-600 dark:border-violet-500 bg-gray-50 dark:bg-gray-800 p-4 rounded-r-lg">
                <h3 class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Overall Intent</h3>
                <p class="text-gray-900 dark:text-gray-50">{{ vm.epic_set_summary.overall_intent }}</p>
            </div>
            {% endif %}
            
            {% if vm.epic_set_summary.mvp_definition %}
            <div class="border-l-4 border-violet-600 dark:border-violet-500 bg-gray-50 dark:bg-gray-800 p-4 rounded-r-lg">
                <h3 class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">MVP Definition</h3>
                <p class="text-gray-900 dark:text-gray-50">{{ vm.epic_set_summary.mvp_definition }}</p>
            </div>
            {% endif %}
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {% if vm.epic_set_summary.key_constraints %}
                <div class="border-l-4 border-amber-600 dark:border-amber-500 bg-gray-50 dark:bg-gray-800 p-4 rounded-r-lg">
                    <h3 class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Key Constraints</h3>
                    <ul class="space-y-1">
                        {% for constraint in vm.epic_set_summary.key_constraints %}
                        <li class="text-gray-900 dark:text-gray-50 text-sm flex items-start">
                            <i data-lucide="alert-triangle" class="w-4 h-4 mr-2 mt-0.5 text-amber-600 dark:text-amber-500 flex-shrink-0"></i>
                            {{ constraint }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                {% if vm.epic_set_summary.out_of_scope %}
                <div class="border-l-4 border-gray-400 dark:border-gray-500 bg-gray-50 dark:bg-gray-800 p-4 rounded-r-lg">
                    <h3 class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Out of Scope</h3>
                    <ul class="space-y-1">
                        {% for item in vm.epic_set_summary.out_of_scope %}
                        <li class="text-gray-700 dark:text-gray-300 text-sm flex items-start">
                            <i data-lucide="x" class="w-4 h-4 mr-2 mt-0.5 text-gray-400 dark:text-gray-500 flex-shrink-0"></i>
                            {{ item }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <div class="space-y-8">
        
        <!-- Epic Sections (MVP, Later) -->
        {% for section in vm.sections %}
        {% if section.epics|length > 0 %}
        <div>
            <div class="flex items-center gap-2 mb-4">
                <i data-lucide="{{ section.icon }}" class="w-6 h-6 {% if section.id == 'mvp' %}text-violet-600 dark:text-violet-500{% else %}text-gray-500 dark:text-gray-400{% endif %}"></i>
                <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-50">{{ section.title }}</h2>
                <span class="text-sm text-gray-500 dark:text-gray-400">({{ section.count }})</span>
            </div>
            <div class="space-y-4">
                {% for epic in section.epics %}
                {% include "public/pages/partials/_epic_card.html" %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
        {% endfor %}

        <!-- Risks Overview -->
        {% if vm.risks_overview %}
        <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700">
            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center gap-2">
                <i data-lucide="alert-triangle" class="w-5 h-5 text-red-600 dark:text-red-500"></i>
                <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-50">Risks Overview</h2>
                <span class="ml-auto text-sm text-gray-500 dark:text-gray-400">{{ vm.risks_overview|length }} risk{{ 's' if vm.risks_overview|length != 1 else '' }}</span>
            </div>
            <div class="p-6 space-y-3">
                {% for risk in vm.risks_overview %}
                <div class="border-l-4 border-red-600 dark:border-red-500 bg-gray-50 dark:bg-gray-800 p-4 rounded-r-lg">
                    <p class="font-medium text-gray-900 dark:text-gray-50 mb-1">{{ risk.description }}</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">{{ risk.impact }}</p>
                    {% if risk.affected_epics %}
                    <div class="flex flex-wrap gap-1">
                        {% for epic_id in risk.affected_epics %}
                        <span class="px-2 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded text-xs font-mono">{{ epic_id }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}


        <!-- Recommendations for Architecture -->
        {% if vm.recommendations_for_architecture %}
        <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700">
            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center gap-2">
                <i data-lucide="lightbulb" class="w-5 h-5 text-violet-600 dark:text-violet-500"></i>
                <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-50">Recommendations for Architecture</h2>
            </div>
            <div class="p-6">
                <ul class="space-y-2">
                    {% for rec in vm.recommendations_for_architecture %}
                    <li class="flex items-start text-sm text-gray-700 dark:text-gray-300">
                        <i data-lucide="arrow-right" class="w-4 h-4 mr-3 mt-0.5 text-violet-600 dark:text-violet-500 flex-shrink-0"></i>
                        {{ rec }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}

    </div>
    
    {% else %}
    <!-- No Epic Backlog - Use shared build UI -->
    {% set doc_type_icon = 'layers' %}
    {% set doc_type_name = 'Epic Backlog' %}
    {% set doc_type_id = 'epic_backlog' %}
    {% include "public/pages/partials/_document_not_found.html" %}
    {% endif %}
</div>