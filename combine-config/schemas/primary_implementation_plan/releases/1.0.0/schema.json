{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "schema://primary_implementation_plan/1.0",
  "title": "Primary Implementation Plan",
  "description": "Preliminary implementation plan with Work Package candidates. Produced before technical architecture to inform architectural decisions. WP candidates are not commitments.",
  "type": "object",
  "additionalProperties": false,
  "required": ["meta", "work_package_candidates"],
  "properties": {
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["schema_version", "artifact_id", "created_at", "source"],
      "properties": {
        "schema_version": { "type": "string", "const": "1.0" },
        "artifact_id": {
          "type": "string",
          "minLength": 1,
          "description": "Unique identifier for this artifact."
        },
        "correlation_id": {
          "type": "string",
          "minLength": 1,
          "description": "Correlation identifier linking to workflow run."
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO-8601 timestamp of artifact creation."
        },
        "source": {
          "type": "string",
          "enum": ["human", "combine_generated", "mixed"],
          "description": "Provenance of the artifact content."
        }
      }
    },

    "epic_set_summary": {
      "type": "object",
      "description": "High-level summary of the candidate set.",
      "additionalProperties": false,
      "properties": {
        "overall_intent": {
          "type": "string",
          "minLength": 10,
          "description": "Summary of what this set of candidates aims to achieve."
        },
        "mvp_definition": {
          "type": "string",
          "description": "What constitutes MVP for this project."
        },
        "key_constraints": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Constraints that shape all candidates."
        },
        "out_of_scope": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Explicit exclusions from all candidates."
        }
      }
    },

    "work_package_candidates": {
      "type": "array",
      "minItems": 1,
      "description": "Work Package candidates for architectural review. Not yet commitments.",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "candidate_id",
          "title",
          "rationale",
          "scope_in",
          "scope_out",
          "dependencies",
          "definition_of_done"
        ],
        "properties": {
          "candidate_id": {
            "type": "string",
            "pattern": "^WPC-\\d{1,4}$",
            "description": "Stable identifier for this WP candidate (e.g., WPC-001)."
          },
          "title": {
            "type": "string",
            "minLength": 3,
            "description": "Work Package candidate title."
          },
          "rationale": {
            "type": "string",
            "minLength": 10,
            "description": "Why this Work Package is needed."
          },
          "scope_in": {
            "type": "array",
            "items": { "type": "string" },
            "description": "What this Work Package covers."
          },
          "scope_out": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Explicit exclusions."
          },
          "dependencies": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Known or suspected dependencies on other WP candidates (by candidate_id)."
          },
          "definition_of_done": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Measurable criteria for completion."
          },
          "governance_notes": {
            "type": "array",
            "items": { "type": "string" },
            "description": "References to ADRs, policies, or constraints that apply."
          }
        }
      }
    },

    "risks_overview": {
      "type": "array",
      "description": "Cross-cutting risks affecting multiple WP candidates.",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["risk_id", "description"],
        "properties": {
          "risk_id": {
            "type": "string",
            "pattern": "^RSK-\\d{1,4}$"
          },
          "description": { "type": "string" },
          "affected_candidates": {
            "type": "array",
            "items": { "type": "string" }
          },
          "mitigation_direction": { "type": "string" }
        }
      }
    },

    "recommendations_for_architecture": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Recommendations for the Technical Architect to consider."
    }
  }
}
