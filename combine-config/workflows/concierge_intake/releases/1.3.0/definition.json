{
  "$schema": "https://thecombine.ai/schemas/workflow-plan.v1.json",
  "workflow_id": "concierge_intake",
  "version": "1.3.0",
  "name": "Intake Gate Document Workflow",
  "description": "Single-pass intake classification and document generation. Auto-completes when QA passes - no manual outcome selection.",
  "scope_type": "document",
  "document_type": "concierge_intake",
  "thread_ownership": {
    "owns_thread": false,
    "thread_purpose": null
  },
  "entry_node_ids": [
    "intake"
  ],
  "nodes": [
    {
      "node_id": "intake",
      "type": "intake_gate",
      "description": "Single-pass classification and extraction of user intent",
      "non_advancing": false,
      "task_ref": "prompt:task:intake_gate:1.0.0",
      "_position": {
        "x": 190,
        "y": 40
      }
    },
    {
      "node_id": "generation",
      "type": "task",
      "description": "Generate structured Intake Document from classified input",
      "task_ref": "prompt:template:document_generator:1.0.0",
      "produces": "concierge_intake_document",
      "_position": {
        "x": -315.77142857142854,
        "y": 373.3428571428571
      },
      "internal_type": "UI",
      "op_ref": "mech:entry:concierge_entry:1.0.0"
    },
    {
      "node_id": "qa",
      "type": "qa",
      "description": "Structural QA on generated intake document",
      "task_ref": "prompt:task:intake_qa:1.0.0",
      "requires_qa": true,
      "qa_mode": "structural",
      "_position": {
        "x": 826.1257142857144,
        "y": 431.86285714285714
      }
    },
    {
      "node_id": "remediation",
      "type": "task",
      "description": "Rework intake document based on QA feedback",
      "task_ref": "prompt:task:intake_document_generation:1.0.0",
      "produces": "concierge_intake_document",
      "_position": {
        "x": 340,
        "y": 610
      }
    },
    {
      "node_id": "end_stabilized",
      "type": "end",
      "description": "Intake qualified and document ready for Project Discovery",
      "terminal_outcome": "stabilized",
      "gate_outcome": "qualified",
      "_position": {
        "x": 40,
        "y": 610
      }
    },
    {
      "node_id": "end_blocked",
      "type": "end",
      "description": "Intake blocked - insufficient info or QA circuit breaker",
      "terminal_outcome": "blocked",
      "gate_outcome": "not_ready",
      "_position": {
        "x": 125,
        "y": 800
      }
    },
    {
      "node_id": "end_abandoned",
      "type": "end",
      "description": "Request out of scope or redirected",
      "terminal_outcome": "abandoned",
      "gate_outcome": null,
      "_position": {
        "x": 498.0571428571428,
        "y": 175.62857142857143
      }
    }
  ],
  "edges": [
    {
      "edge_id": "intake_qualified",
      "from_node_id": "intake",
      "to_node_id": "generation",
      "outcome": "qualified",
      "label": "Request qualified, generate document",
      "kind": "auto"
    },
    {
      "edge_id": "intake_insufficient",
      "from_node_id": "intake",
      "to_node_id": null,
      "outcome": "needs_user_input",
      "label": "Request needs more detail (max 1 question)",
      "kind": "auto",
      "non_advancing": true
    },
    {
      "edge_id": "intake_out_of_scope",
      "from_node_id": "intake",
      "to_node_id": "end_abandoned",
      "outcome": "out_of_scope",
      "label": "Out of scope",
      "kind": "auto"
    },
    {
      "edge_id": "intake_redirect",
      "from_node_id": "intake",
      "to_node_id": "end_abandoned",
      "outcome": "redirect",
      "label": "Redirect to different engagement",
      "kind": "auto"
    },
    {
      "edge_id": "generation_to_qa",
      "from_node_id": "generation",
      "to_node_id": "qa",
      "outcome": "success",
      "label": "Document generated, run structural QA",
      "kind": "auto"
    },
    {
      "edge_id": "generation_failed",
      "from_node_id": "generation",
      "to_node_id": "end_blocked",
      "outcome": "failed",
      "label": "Document generation failed",
      "kind": "auto"
    },
    {
      "edge_id": "qa_pass",
      "from_node_id": "qa",
      "to_node_id": "end_stabilized",
      "outcome": "success",
      "label": "QA passed - auto-complete as qualified",
      "kind": "auto"
    },
    {
      "edge_id": "qa_fail_remediate",
      "from_node_id": "qa",
      "to_node_id": "remediation",
      "outcome": "failed",
      "label": "QA failed, remediate",
      "kind": "auto",
      "conditions": [
        {
          "type": "retry_count",
          "operator": "lt",
          "value": 2
        }
      ]
    },
    {
      "edge_id": "qa_fail_circuit_breaker",
      "from_node_id": "qa",
      "to_node_id": "end_blocked",
      "outcome": "failed",
      "label": "QA failed, circuit breaker - internal bug",
      "kind": "auto",
      "conditions": [
        {
          "type": "retry_count",
          "operator": "gte",
          "value": 2
        }
      ]
    },
    {
      "edge_id": "remediation_to_qa",
      "from_node_id": "remediation",
      "to_node_id": "qa",
      "outcome": "success",
      "label": "Remediation complete, re-run QA",
      "kind": "auto"
    },
    {
      "edge_id": "remediation_failed",
      "from_node_id": "remediation",
      "to_node_id": "end_blocked",
      "outcome": "failed",
      "label": "Remediation failed",
      "kind": "auto"
    }
  ],
  "governance": {
    "adr_references": [
      "ADR-025",
      "ADR-035",
      "ADR-036",
      "ADR-037",
      "ADR-038",
      "ADR-039"
    ],
    "design_principles": [
      "Auto-complete on QA pass - no manual outcome selection",
      "QA failures are internal bugs, not user-facing decisions",
      "Max 1 clarifying question before user must provide more detail",
      "Combine is a work system, not a wizard"
    ],
    "circuit_breaker": {
      "max_retries": 2,
      "applies_to": [
        "qa",
        "remediation"
      ],
      "on_trip": "end_blocked with internal error flag"
    }
  },
  "metadata": {
    "created_date": "2026-01-16",
    "updated_date": "2026-01-23",
    "work_statement": "WS-INTAKE-WORKFLOW-001",
    "changelog": [
      "v1.0: Initial multi-turn Concierge",
      "v1.1: Replaced Concierge with single-pass Intake Gate",
      "v1.2: Removed outcome_gate - auto-complete on QA pass",
      "v1.3: All task_refs use explicit paths (tasks/)"
    ]
  },
  "requires_inputs": []
}