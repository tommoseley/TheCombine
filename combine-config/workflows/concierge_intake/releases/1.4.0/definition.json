{
  "$schema": "https://thecombine.ai/schemas/workflow-plan.v1.json",
  "workflow_id": "concierge_intake",
  "version": "1.4.0",
  "name": "Intake Gate Document Workflow",
  "description": "Gate Profile intake workflow. Pass A classifies, Entry confirms, then generates document.",
  "scope_type": "document",
  "document_type": "concierge_intake",
  "thread_ownership": {
    "owns_thread": false,
    "thread_purpose": null
  },
  "entry_node_ids": [
    "intake_gate"
  ],
  "nodes": [
    {
      "node_id": "intake_gate",
      "type": "gate",
      "description": "Intake Gate Profile: classify, extract, confirm, pin",
      "non_advancing": false,
      "internals": {
        "pass_a": {
          "internal_type": "LLM",
          "description": "LLM classification of user intent",
          "task_ref": "prompt:task:intake_gate:1.0.0",
          "output_schema": "schema:intake_classification:1.0.0"
        },
        "extract": {
          "internal_type": "MECH",
          "description": "Extract key fields from classification",
          "op_ref": "mech:extractor:intake_classification_extractor:1.0.0"
        },
        "entry": {
          "internal_type": "UI",
          "description": "Operator confirms or corrects classification",
          "op_ref": "mech:entry:concierge_entry:1.0.0"
        },
        "pin": {
          "internal_type": "MECH",
          "description": "Pin confirmed fields as binding constraints",
          "op_ref": "mech:invariant_pinner:intake_invariant_pinner:1.0.0"
        }
      },
      "_position": {
        "x": 190,
        "y": 40
      }
    },
    {
      "node_id": "generation",
      "type": "task",
      "description": "Generate structured Intake Document from confirmed classification",
      "internal_type": "LLM",
      "task_ref": "prompt:task:intake_document_generation:1.0.0",
      "produces": "concierge_intake_document",
      "_position": {
        "x": -315,
        "y": 373
      }
    },
    {
      "node_id": "qa",
      "type": "qa",
      "description": "Structural QA on generated intake document",
      "task_ref": "prompt:task:intake_qa:1.0.0",
      "requires_qa": true,
      "qa_mode": "structural",
      "_position": {
        "x": 826,
        "y": 431
      }
    },
    {
      "node_id": "remediation",
      "type": "task",
      "description": "Rework intake document based on QA feedback",
      "task_ref": "prompt:task:intake_document_generation:1.0.0",
      "produces": "concierge_intake_document",
      "_position": {
        "x": 340,
        "y": 610
      }
    },
    {
      "node_id": "end_stabilized",
      "type": "end",
      "description": "Intake qualified and document ready for Project Discovery",
      "terminal_outcome": "stabilized",
      "gate_outcome": "qualified",
      "_position": {
        "x": 40,
        "y": 610
      }
    },
    {
      "node_id": "end_blocked",
      "type": "end",
      "description": "Intake blocked - insufficient info or QA circuit breaker",
      "terminal_outcome": "blocked",
      "gate_outcome": "not_ready",
      "_position": {
        "x": 125,
        "y": 800
      }
    },
    {
      "node_id": "end_abandoned",
      "type": "end",
      "description": "Request out of scope or redirected",
      "terminal_outcome": "abandoned",
      "gate_outcome": null,
      "_position": {
        "x": 498,
        "y": 175
      }
    }
  ],
  "edges": [
    {
      "edge_id": "gate_qualified",
      "from_node_id": "intake_gate",
      "to_node_id": "generation",
      "outcome": "qualified",
      "label": "Classification confirmed, generate document",
      "kind": "auto"
    },
    {
      "edge_id": "gate_needs_clarification",
      "from_node_id": "intake_gate",
      "to_node_id": null,
      "outcome": "needs_clarification",
      "label": "LLM needs more detail from user",
      "kind": "auto",
      "non_advancing": true
    },
    {
      "edge_id": "gate_out_of_scope",
      "from_node_id": "intake_gate",
      "to_node_id": "end_abandoned",
      "outcome": "out_of_scope",
      "label": "Out of scope",
      "kind": "auto"
    },
    {
      "edge_id": "generation_to_qa",
      "from_node_id": "generation",
      "to_node_id": "qa",
      "outcome": "success",
      "label": "Document generated, run structural QA",
      "kind": "auto"
    },
    {
      "edge_id": "generation_failed",
      "from_node_id": "generation",
      "to_node_id": "end_blocked",
      "outcome": "failed",
      "label": "Document generation failed",
      "kind": "auto"
    },
    {
      "edge_id": "qa_pass",
      "from_node_id": "qa",
      "to_node_id": "end_stabilized",
      "outcome": "success",
      "label": "QA passed - auto-complete as qualified",
      "kind": "auto"
    },
    {
      "edge_id": "qa_fail_remediate",
      "from_node_id": "qa",
      "to_node_id": "remediation",
      "outcome": "failed",
      "label": "QA failed, remediate",
      "kind": "auto",
      "conditions": [
        {
          "type": "retry_count",
          "operator": "lt",
          "value": 2
        }
      ]
    },
    {
      "edge_id": "qa_fail_circuit_breaker",
      "from_node_id": "qa",
      "to_node_id": "end_blocked",
      "outcome": "failed",
      "label": "QA failed, circuit breaker - internal bug",
      "kind": "auto",
      "conditions": [
        {
          "type": "retry_count",
          "operator": "gte",
          "value": 2
        }
      ]
    },
    {
      "edge_id": "remediation_to_qa",
      "from_node_id": "remediation",
      "to_node_id": "qa",
      "outcome": "success",
      "label": "Remediation complete, re-run QA",
      "kind": "auto"
    },
    {
      "edge_id": "remediation_failed",
      "from_node_id": "remediation",
      "to_node_id": "end_blocked",
      "outcome": "failed",
      "label": "Remediation failed",
      "kind": "auto"
    }
  ],
  "governance": {
    "adr_references": [
      "ADR-025",
      "ADR-035",
      "ADR-036",
      "ADR-037",
      "ADR-038",
      "ADR-039",
      "ADR-047"
    ],
    "design_principles": [
      "Gate Profile: LLM classify -> MECH extract -> UI confirm -> MECH pin",
      "Auto-complete on QA pass - no manual outcome selection",
      "QA failures are internal bugs, not user-facing decisions",
      "No special-case handler code - all logic in workflow definition"
    ],
    "circuit_breaker": {
      "max_retries": 2,
      "applies_to": [
        "qa",
        "remediation"
      ],
      "on_trip": "end_blocked with internal error flag"
    }
  },
  "metadata": {
    "created_date": "2026-01-16",
    "updated_date": "2026-02-07",
    "work_statement": "WS-ADR-047-005",
    "changelog": [
      "v1.0: Initial multi-turn Concierge",
      "v1.1: Replaced Concierge with single-pass Intake Gate",
      "v1.2: Removed outcome_gate - auto-complete on QA pass",
      "v1.3: All task_refs use explicit paths",
      "v1.4: Refactored to Gate Profile with LLM/MECH/UI internals (ADR-047)"
    ]
  },
  "requires_inputs": []
}
