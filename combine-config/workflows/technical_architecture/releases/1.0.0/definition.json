{
  "$schema": "https://thecombine.ai/schemas/workflow-plan.v1.json",
  "workflow_id": "technical_architecture",
  "version": "1.0.0",
  "name": "Technical Architecture Workflow",
  "description": "Document creation workflow for Technical Architecture",
  "scope_type": "document",
  "document_type": "technical_architecture",
  "thread_ownership": {
    "owns_thread": false,
    "thread_purpose": null
  },
  "entry_node_ids": [
    "pgc"
  ],
  "nodes": [
    {
      "node_id": "pgc",
      "type": "pgc",
      "description": "Pre-generation clarification for Technical Architecture",
      "task_ref": "prompt:template:pgc_clarifier:1.0.0",
      "includes": {
        "PGC_CONTEXT": "seed/prompts/pgc-contexts/technical_architecture.v1.txt",
        "OUTPUT_SCHEMA": "seed/schemas/clarification_question_set.v2.json",
        "ROLE_PROMPT": "prompt:role:technical_architect:1.0.0",
        "TASK_PROMPT": "prompt:task:technical_architecture:1.0.0"
      },
      "_position": {
        "x": 50,
        "y": 40
      }
    },
    {
      "node_id": "generation",
      "type": "task",
      "description": "Generate Technical Architecture document",
      "task_ref": "prompt:template:document_generator:1.0.0",
      "includes": {
        "ROLE_PROMPT": "prompt:role:technical_architect:1.0.0",
        "TASK_PROMPT": "prompt:task:technical_architecture:1.0.0",
        "OUTPUT_SCHEMA": "schema:technical_architecture:1.0.0"
      },
      "produces": "technical_architecture",
      "_position": {
        "x": 50,
        "y": 230
      }
    },
    {
      "node_id": "qa",
      "type": "qa",
      "description": "QA evaluation for Technical Architecture",
      "task_ref": "tasks/Technical Architecture QA v1.0",
      "requires_qa": true,
      "qa_mode": "semantic",
      "_position": {
        "x": -360.2857142857141,
        "y": 319.5714285714285
      }
    },
    {
      "node_id": "remediation",
      "type": "task",
      "description": "Rework Technical Architecture based on QA feedback",
      "task_ref": "templates/Document Generator v1.0",
      "includes": {
        "ROLE_PROMPT": "seed/prompts/roles/Technical Architect 1.0.txt",
        "TASK_PROMPT": "seed/prompts/tasks/Technical Architecture v1.0.txt",
        "OUTPUT_SCHEMA": "seed/schemas/technical_architecture.v1.json"
      },
      "produces": "technical_architecture",
      "_position": {
        "x": 466.43428571428615,
        "y": 523.3142857142857
      }
    },
    {
      "node_id": "end_complete",
      "type": "end",
      "description": "Technical Architecture document ready",
      "terminal_outcome": "stabilized",
      "gate_outcome": "complete",
      "_position": {
        "x": 40,
        "y": 610
      }
    },
    {
      "node_id": "end_failed",
      "type": "end",
      "description": "Generation failed",
      "terminal_outcome": "blocked",
      "gate_outcome": "failed",
      "_position": {
        "x": 190,
        "y": 800
      }
    }
  ],
  "edges": [
    {
      "edge_id": "pgc_to_generation",
      "from_node_id": "pgc",
      "to_node_id": "generation",
      "outcome": "success",
      "label": "Clarification complete, proceed to generation",
      "kind": "auto"
    },
    {
      "edge_id": "pgc_needs_answers",
      "from_node_id": "pgc",
      "to_node_id": null,
      "outcome": "needs_user_input",
      "label": "User must answer clarification questions",
      "kind": "auto",
      "non_advancing": true
    },
    {
      "edge_id": "generation_to_qa",
      "from_node_id": "generation",
      "to_node_id": "qa",
      "outcome": "success",
      "label": "Document generated, run QA",
      "kind": "auto"
    },
    {
      "edge_id": "generation_failed",
      "from_node_id": "generation",
      "to_node_id": "end_failed",
      "outcome": "failed",
      "label": "Document generation failed",
      "kind": "auto"
    },
    {
      "edge_id": "qa_pass",
      "from_node_id": "qa",
      "to_node_id": "end_complete",
      "outcome": "success",
      "label": "QA passed - document complete",
      "kind": "auto"
    },
    {
      "edge_id": "qa_fail_remediate",
      "from_node_id": "qa",
      "to_node_id": "remediation",
      "outcome": "failed",
      "label": "QA failed, remediate",
      "kind": "auto",
      "conditions": [
        {
          "type": "retry_count",
          "operator": "lt",
          "value": 2
        }
      ]
    },
    {
      "edge_id": "qa_fail_circuit_breaker",
      "from_node_id": "qa",
      "to_node_id": "end_failed",
      "outcome": "failed",
      "label": "QA failed, circuit breaker",
      "kind": "auto",
      "conditions": [
        {
          "type": "retry_count",
          "operator": "gte",
          "value": 2
        }
      ]
    },
    {
      "edge_id": "remediation_to_qa",
      "from_node_id": "remediation",
      "to_node_id": "qa",
      "outcome": "success",
      "label": "Remediation complete, re-run QA",
      "kind": "auto"
    },
    {
      "edge_id": "remediation_failed",
      "from_node_id": "remediation",
      "to_node_id": "end_failed",
      "outcome": "failed",
      "label": "Remediation failed",
      "kind": "auto"
    }
  ],
  "governance": {
    "adr_references": [],
    "design_principles": [
      "Auto-complete on QA pass",
      "PGC clarification before generation"
    ],
    "circuit_breaker": {
      "max_retries": 2,
      "applies_to": [
        "qa",
        "remediation"
      ],
      "on_trip": "end_failed with internal error flag"
    }
  },
  "metadata": {
    "created_date": "2026-02-05",
    "updated_date": "2026-02-05",
    "changelog": [
      "v1.0.0: Initial workflow created"
    ]
  },
  "requires_inputs": []
}