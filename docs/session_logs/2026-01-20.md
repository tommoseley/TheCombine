# Session Summary - 2026-01-20

## Scope
- Project model alignment with database schema (6 missing columns)
- Complete elimination of raw SQL tech debt in project/document routes
- Behavior-preserving refactoring with tests-first approach

## Decisions Made
- Tests written BEFORE refactoring to codify current behavior
- All raw SQL converted to ORM for project operations
- Lazy imports used to avoid circular dependencies

## Implemented
- Added 6 missing columns to Project model (owner_id, organization_id, icon, archived_at, archived_by, archived_reason)
- Converted `project_routes.py` from 10 raw SQL queries to ORM
- Converted `document_routes.py` from 2 raw SQL queries to ORM  
- Converted `archive.py` dependency from raw SQL to ORM
- Converted `_create_project_from_intake()` from raw SQL to ORM
- Updated all related unit tests for ORM mocking patterns
- Rewrote `test_concierge_intake_plan.py` for v1.2.0 schema

## Updated or Created
- `app/api/models/project.py` - added 6 columns, updated to_dict()
- `app/web/routes/public/project_routes.py` - full ORM rewrite
- `app/web/routes/public/document_routes.py` - ORM helpers
- `app/web/routes/public/intake_workflow_routes.py` - ORM project creation
- `app/core/dependencies/archive.py` - ORM with lazy import
- `tests/unit/test_project_model.py` - ORM mocking
- `tests/unit/test_archive_dependency.py` - ORM mocking
- `tests/domain/registry/test_view_docdef_resolution.py` - ORM mocking
- `tests/domain/workflow/test_concierge_intake_plan.py` - v1.2.0 schema
- `tests/web/test_intake_workflow_bff.py` - async test fixes
- `seed/workflows/concierge_intake.v1.json` - fixed BOM/JSON structure
- `docs/PROJECT_STATE.md` - updated

## Commits / PRs
- None (pending user commit)

## Open Threads
- None - raw SQL tech debt fully resolved

## Known Risks / Drift Warnings
- None

## Test Results
- 1603 passed, 3 warnings