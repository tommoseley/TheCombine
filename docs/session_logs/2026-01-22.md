# Session Summary - 2026-01-22

## Scope
- Fixed infinite question loop in Concierge intake by replacing LLM-based readiness with mechanical sufficiency check
- Fixed message history persistence in inline drafting UX
- Fixed home page rendering issue (corrupted HTML attributes)

## Decisions Made
- Intake Sufficiency Rule: Intake is complete when `audience` and `artifact_type` are non-null - no LLM judgment
- One question at a time for missing fields only - no multi-question prompts
- Field extraction via regex pattern matching, not LLM classification

## Implemented
- `app/domain/workflow/nodes/intake_gate.py`: Complete rewrite with mechanical sufficiency
  - `IntakeFrame` dataclass with `is_complete()` and `missing_field()` methods
  - Pattern-based extraction for artifact_type (web_app, mobile_app, API, etc.)
  - Pattern-based extraction for audience (children, students, developers, etc.)
  - Accumulates raw_inputs across conversation turns
  - Reads frame state from node_history metadata (persists across calls)
- Fixed import errors (NodeResult, DocumentWorkflowContext from nodes.base)
- Fixed corrupted HTML in home.html (malformed comments, broken attributes from regex)

## Updated or Created
- `app/domain/workflow/nodes/intake_gate.py` - Complete rewrite (mechanical sufficiency)
- `app/web/templates/public/pages/home.html` - Fixed corrupted HTML attributes

## Commits / PRs
- None (changes not yet committed)

## Open Threads
- Review panel still renders as separate page instead of inline in chat flow
- Need to update `_build_template_context` or endpoint to return `_drafting_log_content.html` with review panel embedded

## Known Risks / Drift Warnings
- Mechanical extraction patterns may miss edge cases (e.g., unusual artifact types)
- Frame state is stored in node_history metadata - ensure proper serialization