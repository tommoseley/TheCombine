# Session Summary - 2026-01-23

## Scope
- ADR-041 Phase 10 partial: PGC prompt migration for Project Discovery Questions
- Schema v1 → v2 migration fixes
- PromptAssemblyService creation for programmatic and API access
- Test fixes for IntakeGate, ClarificationGate, QAGate, ProjectModel

## Decisions Made
- Created `PromptAssemblyService` as wrapper around `PromptAssembler` for both programmatic and API use
- Admin prompt assembly endpoints placed behind `ENABLE_DEBUG_ROUTES` feature flag
- Schema field rename: `intent` → `why_it_matters` per v2 schema
- Identified need for standard document-build template with role/task/schema sections (not implemented)

## Implemented
- `seed/prompts/tasks/Clarification Questions Generator v1.0.txt` - Generic template with `$$PGC_CONTEXT` and `$$OUTPUT_SCHEMA` tokens
- `seed/prompts/pgc-contexts/project_discovery.v1.txt` - Project Discovery context block
- `seed/workflows/pm_discovery.v1.json` updated to v1.1.0 with PGC node and includes map
- `app/domain/services/prompt_assembly_service.py` - Service wrapper (8,995 bytes)
- Admin API endpoints: `POST /api/admin/prompts/assemble`, `GET /api/admin/prompts/workflows/{wf}/nodes/{node}/assemble`, `GET /api/admin/prompts/workflows`
- `tests/tier1/prompt/test_prompt_assembly_service.py` - 8 service tests

## Updated or Created
- `app/domain/workflow/gates/clarification.py` - schema v1→v2, `intent`→`why_it_matters`
- `app/domain/workflow/gates/qa.py` - schema mapping v1→v2
- `app/domain/workflow/nodes/intake_gate.py` - added `get_supported_node_type()`
- `tests/domain/workflow/gates/test_clarification.py` - schema v2 fixtures
- `tests/domain/workflow/gates/test_qa.py` - schema v2 fixtures
- `tests/domain/workflow/nodes/test_intake_gate.py` - complete rewrite for mechanical sufficiency
- `tests/unit/test_project_model.py` - assertion fix for Project + Document

## Commits / PRs
- None (user performs Git operations)

## Open Threads
- Need standard document-build template with role/task/schema sections
- Old monolithic `Project Discovery Questions v1.0.txt` can be moved to recycle/
- Canonical `project_discovery_schema.v1.json` provided by user, needs to be added to seed/schemas/
- Phase 8-9 of WS-ADR-041-001 not started (Audit Logging Integration, CI Prompt Compile Job)

## Known Risks / Drift Warnings
- Two `PromptAssembler` classes exist: ADR-034 (database-driven) and ADR-041 (filesystem template). May cause confusion.
- `PromptAssemblyService` naming could conflict with ADR-034's `PromptAssembler` in `app/domain/services/prompt_assembler.py`