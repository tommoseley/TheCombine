# Session Summary - 2026-01-31

## Scope
- Plan and begin implementation of New Project Concierge Intake Experience in React SPA

## Decisions Made
- Replace simple "New Project" button flow with full conversational concierge intake experience
- Create new `/api/v1/intake/` router with JSON responses for SPA consumption
- Use sidecar overlay pattern (not attached to a node) for concierge chat interface
- Follow existing QuestionTray styling patterns with violet accent for concierge
- Create dedicated `useConciergeIntake` hook to encapsulate all workflow logic

## Planned Implementation

### Phase 1: Add JSON API Endpoints
Create `/api/v1/intake/` router with:
- POST /api/v1/intake/start - Start new intake workflow
- GET /api/v1/intake/{execution_id} - Get current state
- POST /api/v1/intake/{execution_id}/message - Submit user message
- PATCH /api/v1/intake/{execution_id}/field/{key} - Update interpretation field
- POST /api/v1/intake/{execution_id}/initialize - Lock fields, start generation
- GET /api/v1/intake/{execution_id}/status - Poll during generation

### Phase 2: Create React Hook
`spa/src/hooks/useConciergeIntake.js` encapsulating:
- startIntake(), submitMessage(), updateField(), lockAndGenerate()
- Polling logic for generation phase
- State: phase, messages, pendingPrompt, interpretation, project, error

### Phase 3: Create Sidecar Components
- `ConciergeIntakeSidecar.jsx` - Main container
- `concierge/MessageList.jsx` - Chat bubble display
- `concierge/ChatInput.jsx` - Textarea with Enter-to-send
- `concierge/InterpretationEditor.jsx` - Editable fields for review phase
- `concierge/GeneratingIndicator.jsx` - Spinner during document generation
- `concierge/CompletionCard.jsx` - Success message with "View Project" button

### Phase 4: Integrate with App
- Add `showIntakeSidecar` state to App.jsx
- Pass `onNewProject` to ProjectTree that opens sidecar
- Handle completion: add project to list, select it, close sidecar

### Phase 5: Add API Client Methods
Add intake methods to `spa/src/api/client.js`

## Files to Create
1. `app/api/v1/routers/intake.py`
2. `spa/src/hooks/useConciergeIntake.js`
3. `spa/src/components/ConciergeIntakeSidecar.jsx`
4. `spa/src/components/concierge/MessageList.jsx`
5. `spa/src/components/concierge/ChatInput.jsx`
6. `spa/src/components/concierge/InterpretationEditor.jsx`
7. `spa/src/components/concierge/GeneratingIndicator.jsx`
8. `spa/src/components/concierge/CompletionCard.jsx`

## Files to Modify
1. `app/api/v1/__init__.py` - Register intake router
2. `spa/src/api/client.js` - Add intake API methods
3. `spa/src/App.jsx` - Add sidecar state and rendering
4. `spa/src/components/ProjectTree.jsx` - Simplify new project trigger

## Implemented
- Created `app/api/v1/routers/intake.py` - JSON API endpoints for intake workflow
- Registered intake router in `app/api/v1/__init__.py`
- Added intake API client methods to `spa/src/api/client.js`
- Created `spa/src/hooks/useConciergeIntake.js` - React hook for intake workflow state
- Created sidecar components:
  - `spa/src/components/ConciergeIntakeSidecar.jsx` - Main container
  - `spa/src/components/concierge/MessageList.jsx` - Chat message display
  - `spa/src/components/concierge/ChatInput.jsx` - Text input with Enter-to-send
  - `spa/src/components/concierge/InterpretationEditor.jsx` - Review phase fields
  - `spa/src/components/concierge/GeneratingIndicator.jsx` - Generation spinner
  - `spa/src/components/concierge/CompletionCard.jsx` - Success/completion display
- Modified `spa/src/App.jsx` - Added sidecar state and rendering
- Simplified `spa/src/components/ProjectTree.jsx` - Removed inline name input, triggers sidecar

## Updated or Created
- docs/session_logs/2026-01-31.md (this file)
- docs/PROJECT_STATE.md (updated)

## Commits / PRs
- None yet

## Open Threads
- Need to verify existing workflow engine integration for concierge intake
- Consider whether HTMX intake routes can be reused or need separate JSON handlers

## Known Risks / Drift Warnings
- Large implementation spanning backend API and React SPA
- Must ensure proper cleanup if intake is abandoned mid-flow
