# Session Summary - 2026-02-07

## Scope
- Complete WS-ADR-047-005 Phase 4 (IntakeGateProfileExecutor) and Phase 5 (cleanup)
- Activate and test Gate Profile v1.4.0 for concierge_intake workflow
- Draft ADR-048 for Intake POW and Workflow Routing architecture
- Create `intake_and_route` POW as the front-door workflow
- Create `intake_route` router mechanical operation and RouterHandler

## Decisions Made
- Gate Profile pattern adopted: Gates with internals (pass_a/LLM, extract/MECH, entry/UI, pin/MECH) replace special-case executor code
- Complete-and-handoff spawn model: Intake POW completes fully, spawns distinct POW execution with lineage tracking
- Routing as mechanical operation: Route selection is config-driven via RouterHandler, no LLM for routing decisions
- Lineage tracking: Spawned POW stores `spawned_from_execution_id`, `spawned_by_operation_id`; project maintains `executions[]` array
- ADR-047 marked complete (all 5 work statements delivered)

## Implemented
- `app/domain/workflow/nodes/intake_gate_profile.py` - IntakeGateProfileExecutor for Gate Profile pattern
- `app/domain/workflow/nodes/gate.py` - Updated to delegate to profile executor when internals present
- `app/domain/workflow/plan_executor.py` - Added `internals` field to node_config, scoped legacy pause to INTAKE_GATE only
- `app/api/services/mech_handlers/router.py` - RouterHandler for intake_route operation
- `combine-config/workflows/intake_and_route/releases/1.0.0/definition.json` - Front-door POW (4 steps)
- `combine-config/mechanical_ops/intake_route/releases/1.0.0/operation.yaml` - Router operation config
- `combine-config/schemas/routing_decision/releases/1.0.0/schema.json` - Routing decision schema
- `docs/adr/ADR-048-intake-pow-and-routing.md` - Full ADR for Intake POW architecture

## Updated or Created
- `combine-config/_active/active_releases.json` - Added intake_and_route, routing_decision, intake_route
- `seed/workflows/concierge_intake.v1.json` - Synced v1.4.0 from combine-config
- `app/api/services/mech_handlers/__init__.py` - Added RouterHandler import
- `docs/PROJECT_STATE.md` - Updated with ADR-047 complete, ADR-048 draft status

## Commits / PRs
- None (work in progress on branch workbench/ws-b94c2959c2cf)

## Open Threads
- `confirm_route` entry operation for low-confidence routing confirmation
- `spawn_pow_instance` mechanical operation to create follow-on POW with lineage
- Wire intake_and_route POW to actually execute (currently definition only)
- UX: Collapsed receipt view for completed Intake POW

## Known Risks / Drift Warnings
- LLM classification in Gate Profile has prompt ref parsing issue (`prompt:task:intake_gate:1.0.0` resolves incorrectly); fallback pattern matching works
- Dual workflow loading paths: PlanRegistry loads from `seed/workflows/`, AdminWorkbench uses PackageLoader with `combine-config/` - must keep in sync
- `seed/workflows/` must be synced with `combine-config/` for PlanRegistry to load correct versions
