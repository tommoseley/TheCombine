# Session Summary - 2026-02-16 (Session 2)

## Scope
- BCP POW design review v1.0 through v1.2, authoring v1.2 design document
- BacklogItem v1 schema upgrade (level-specific details, TASK level, lineage, hash boundary)
- Mechanical risk_summary derivation in IPF handler
- Progressive expansion model (v1.3): discrete fan-out POWs replacing monolithic pipeline phases
- boundary_uncertain flag on FeatureDetails, source_hash staleness mechanism

## Decisions Made
- BacklogItem uses unified schema with level discriminator and details oneOf (EpicDetails, FeatureDetails, StoryDetails, TaskDetails)
- priority_score is integer-only (avoids canonicalization drift across serializers)
- STORY directly under EPIC is disallowed (must go through FEATURE)
- Hash boundary invariant: backlog_hash computed from base fields only (id, level, parent_id, sorted(depends_on), priority_score); details/title/summary excluded
- IPF risk_summary is mechanically derived from per-epic risks in handler transform() â€” LLM no longer generates it
- Planning artifacts may contain redundancy for readability; execution artifacts must not
- Monolithic pipeline phases (v1.2) superseded by discrete UI-triggered fan-out POWs (v1.3)
- Coverage audit moved from pipeline Phase 2.5 into IPF DCW (pre-acceptance)
- Story dependency scope: within-epic cross-feature allowed, cross-epic disallowed with warning (v1)
- Staleness keyed off source_hash on pipeline_run records (parent structural hash at generation time)
- Reconciliation UI shows summary before applying drops (operator confirms)
- Plan compilation is operator-triggered with nudge banner, not auto-compiled after every fan-out
- Sibling Epic Boundary Summary provided as context to feature generator (coherence, not dedupe)
- boundary_uncertain flag on FeatureDetails for ambiguous epic boundary placement
- epics_only mode for lightweight initial compile

## Implemented
- BacklogItem v1 schema: level-specific details, TASK level, lineage fields, parent_id pattern enforcement, hash boundary invariant
- list.schema.json generalized from intent_id to source_id/source_type
- Backlog generator task prompt rewritten for v1 schema
- Synced document_types output schema with canonical schema
- Updated test fixtures in 3 test files (test_backlog_pipeline.py, test_backlog_ordering.py, test_graph_validator.py)
- IPF handler transform() mechanically derives risk_summary from per-epic risks
- IPF task prompt updated: LLM told not to generate risk_summary
- boundary_uncertain boolean added to FeatureDetails in both schema copies
- source_hash and source_id added to pipeline_run replay_metadata
- BCP POW design doc rewritten as v1.3 with all design decisions

## Updated or Created
- `combine-config/schemas/backlog_item/releases/1.0.0/schema.json` (upgraded to v1)
- `combine-config/schemas/backlog_item/releases/1.0.0/list.schema.json` (generalized)
- `combine-config/document_types/backlog_item/releases/1.0.0/schemas/output.schema.json` (synced)
- `combine-config/prompts/tasks/backlog_generator/releases/1.0.0/task.prompt.txt` (rewritten)
- `combine-config/document_types/implementation_plan/releases/1.0.0/prompts/task.prompt.txt` (risk_summary removed)
- `combine-config/prompts/tasks/implementation_plan/releases/1.0.0/task.prompt.txt` (risk_summary removed)
- `app/domain/handlers/implementation_plan_handler.py` (mechanical risk_summary)
- `app/domain/services/backlog_pipeline.py` (source_hash/source_id)
- `app/domain/services/backlog_ordering.py` (comment update)
- `tests/tier1/handlers/test_implementation_plan_handler.py` (5 new risk_summary tests)
- `tests/tier1/services/test_backlog_pipeline.py` (source_hash test, fixture updates)
- `tests/tier1/services/test_backlog_ordering.py` (fixture updates, details hash test)
- `tests/tier1/services/test_graph_validator.py` (fixture updates)
- `docs/implementation-plans/PROJECT-BACKLOG-COMPILATION-POW-Design-v1.2.md` (rewritten as v1.3)

## Commits / PRs
- `0f5027d` feat: BacklogItem v1 schema, mechanical risk_summary, BCP POW v1.2 design
- `b0abda7` feat: Progressive expansion model, boundary_uncertain flag, source_hash staleness

## Open Threads
- WS-BCP-005 scope defined but not yet started (EpicFeatureFanoutPOW, FeatureStoryFanoutPOW, UI buttons, staleness, reconciliation)
- Epic render_model support for FullDocumentViewer (currently raw JSON fallback)
- Coverage audit pass within IPF DCW not yet implemented
- Graph validator does not yet enforce story dependency scope policy (within-epic only)
- ID pattern (E###/F###/S###/T###) acknowledged as future migration tax if projects exceed 999 items per level

## Known Risks / Drift Warnings
- Two copies of BacklogItem schema must be kept in sync (schemas/ and document_types/)
- Two copies of IPF task prompt must be kept in sync (prompts/tasks/ and document_types/)
- Design doc file is still named v1.2.md but content is v1.3 (cosmetic; rename on next touch)
