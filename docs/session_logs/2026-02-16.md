# Session Summary - 2026-02-16

## Scope
- Make L2 (epic) documents viewable on the production floor

## Decisions Made
- "View Document" button decoupled from L1 gate — any stabilized node is viewable
- "Start Production" remains L1-only (no workflow for construct-mode docs)
- L2 view uses `instance_id` query param to disambiguate multi-instance doc types
- FullDocumentViewer falls back to raw JSON for epics (no render_model yet — follow-up)

## Implemented
- Backend: `instance_id` optional query param on `GET /{project_id}/documents/{doc_type_id}` and `GET /{project_id}/documents/{doc_type_id}/render-model`
- Backend: `instance_id` included in child track dict from production service
- SPA transformer: `docTypeId` and `instanceId` fields carried on all nodes and children
- SPA DocumentNode: View Document button shown for all stabilized nodes (L1 and L2)
- SPA DocumentNode: View callback passes `{ docTypeId, instanceId }` for L2, plain `id` for L1
- SPA Floor: `fullViewerDocId` state accepts string or `{ docTypeId, instanceId }` object
- SPA FullDocumentViewer: accepts `instanceId` prop, passes to all API calls
- SPA API client: `getDocument`, `getDocumentRenderModel`, `getDocumentPgc` accept optional `instanceId`
- Test fix: `FakeDocument` stub updated with `instance_id` attribute

## Updated or Created
- `app/api/v1/routers/projects.py`
- `app/api/services/production_service.py`
- `spa/src/api/client.js`
- `spa/src/api/transformers.js`
- `spa/src/components/DocumentNode.jsx`
- `spa/src/components/Floor.jsx`
- `spa/src/components/FullDocumentViewer.jsx`
- `tests/tier1/services/test_production_child_tracks.py`
- `spa/dist/` (rebuilt)

## Commits / PRs
- `7ea7b7d` feat: Make L2 documents viewable on production floor

## Open Threads
- Epic render_model support not added (FullDocumentViewer falls back to raw JSON)
- No "Expand" affordance for epics yet (future: fan out into features/stories)

## Known Risks / Drift Warnings
- None
