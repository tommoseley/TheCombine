# Session Summary - 2026-02-22

## Scope
- Bypass DocDef layer: render tabs directly from IA config + raw content (ADR-054)
- WS-SDP-003: Align IPF DCW inputs with ADR-053 document creation order

## Decisions Made
- IA config (rendering_config, information_architecture) injected on ALL render-model API paths, not just DocDef success path
- SPA routes to tabbed viewer when rendering_config present, before checking sections.length
- TechnicalArchitectureViewer renders tabs from raw_content via IA binds when sections are empty
- Envelope fallback: when raw_content is envelope format with no IA-matching fields, extract text and display in first tab
- IPF DCW no longer requires technical_architecture input (TA runs after IPF per ADR-053)
- IPF DCW and package.yaml both require: primary_implementation_plan, project_discovery
- ta_version_id changed from required to optional in IPF schemas (may be "pending_ta")

## Implemented
- Backend: `_inject_ia_config()` helper in projects.py, called on no_view_docdef, DocDefNotFoundError, and success paths
- Backend: Moved envelope unwrapping before the no_view_docdef gate so both paths get unwrapped content
- Backend: DocDefNotFoundError path uses document_data (unwrapped) and display_title (humanized)
- SPA: FullDocumentViewer checks rendering_config before sections.length gate
- SPA: TechnicalArchitectureViewer raw content mode with RawContentTabContent, RawFieldRenderer, RawStructuredItem components
- SPA: Envelope text extraction fallback in TechnicalArchitectureViewer
- Config: IPF DCW requires_inputs updated (removed technical_architecture, added project_discovery)
- Config: IPF task prompt rewritten for IPP-only input baseline
- Config: IPF schemas (both copies) — governance_pins.required changed from ["ta_version_id"] to []
- Config: IPF package.yaml — added project_discovery to required_inputs
- Tests: test_all_tab_sections_resolve_to_binds (4 parametrized cases)
- Tests: test_ipf_input_alignment.py (5 alignment tests for WS-SDP-003)
- Docs: WS-SDP-003.md drafted and accepted

## Updated or Created
- app/api/v1/routers/projects.py
- spa/src/components/FullDocumentViewer.jsx
- spa/src/components/viewers/TechnicalArchitectureViewer.jsx
- combine-config/document_types/implementation_plan/releases/1.0.0/package.yaml
- combine-config/document_types/implementation_plan/releases/1.0.0/prompts/task.prompt.txt
- combine-config/document_types/implementation_plan/releases/1.0.0/schemas/output.schema.json
- combine-config/schemas/implementation_plan/releases/1.0.0/schema.json
- combine-config/workflows/implementation_plan/releases/1.0.0/definition.json
- tests/tier1/test_information_architecture.py (extended)
- tests/tier1/test_ipf_input_alignment.py (new)
- docs/work-statements/WS-SDP-003.md (new)

## Commits / PRs
- c3559c6 feat: WS-SDP-003 — Bypass DocDef layer for IA-driven tab rendering + align IPF inputs with ADR-053

## Open Threads
- IPF still shows envelope error content (LLM received wrong inputs before ADR-053 fix) — need to re-run IPF generation with corrected inputs
- TA rendering works with tabs from raw content; IPF will work once regenerated
- Other Tier-1 doc types (project_discovery, primary_implementation_plan) not yet verified with tab rendering

## Known Risks / Drift Warnings
- Two copies of IPF schema must remain in sync (combine-config/schemas/ and combine-config/document_types/)
- TechnicalArchitectureViewer handles all doc types despite its name — consider renaming if scope grows
