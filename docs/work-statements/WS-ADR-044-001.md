# WS-ADR-044-001: Admin Workbench UX — Left Rail and Tab Bar Redesign

| | |
|---|---|
| **Status** | Accepted |
| **Date** | 2026-02-04 |
| **Scope** | Single-commit |
| **Governing ADRs** | ADR-044 (Admin Workbench), ADR-045 (System Ontology) |
| **Governing Policies** | POL-WS-001 |
| **Estimated Effort** | 4–6 hours |
| **Reference Artifact** | `workbench-wireframe.html` (approved wireframe, this session) |

---

## Purpose

Restructure the Admin Workbench left rail and editor tab bar to eliminate UX confusion and align the interface with the composition hierarchy established in ADR-045.

**Current problems (observed):**

1. POW sub-sections (Reference Workflows / Template Workflows / Instance Workflows) split workflow items across three collapsible groups — users must expand each to find what they need
2. Document Workflows sub-section groups items by category (intake, architecture, planning, **other**) — the "other" category label is meaningless and buries the most important artifacts
3. Interactions and Schemas in Building Blocks expand to show full duplicate item lists — the same document types appear under Document Workflows, Interactions, AND Schemas
4. The editor tab bar renders up to 11 flat tabs with no grouping — it does not communicate which Interaction Pass each artifact belongs to

**Target state:**

- Left rail organized by composition hierarchy: POWs (flat, with `pow_class` badge) → DCWs (flat, with version badge) → Building Blocks → Governance
- No duplicate item lists anywhere in the left rail
- Editor tab bar: 6 top-level tabs with dropdown menus grouping artifacts by Interaction Pass (Generation, QA, PGC)

---

## Governing References

- **ADR-044**: Admin Workbench — defines the three-panel layout and editing model
- **ADR-045 §7**: Left rail MUST be organized by abstraction level, not by artifact type or file structure
- **POL-WS-001**: Work Statement execution standard

---

## Scope

### Included

- Restructure `DocTypeBrowser.jsx` left rail
- Restructure `PromptEditor.jsx` tab bar
- Add a `TabDropdown` component for grouped tabs (Generation, QA, PGC)
- CSS additions to `themes.css` for new visual elements (dot indicators, count badges, dropdown menu)
- Visual refinement to match approved wireframe

### Excluded

- No changes to editor content areas (`PromptTab`, `PackageEditor`, `WorkflowEditorContent`, `ResolvedPreview`)
- No changes to `RoleEditor`, `TemplateEditor`, or `StepWorkflowEditor`
- No changes to `GitStatusPanel`
- No backend API changes
- No changes to data models, hooks, or API client
- No prompt fragment extraction (separate future work)
- No changes to the Create Workflow UX (retain existing "+ New" flow as-is, relocated into the new structure)

---

## Preconditions

1. ADR-045 accepted and execution complete ✓
2. ADR-044 accepted ✓
3. Current Admin Workbench functional ✓
4. Wireframe reviewed and approved by product owner ✓ (this session)

---

## Procedure

### Phase 1: Left Rail Restructure

Target: `spa/src/components/admin/DocTypeBrowser.jsx`

**Step 1.1 — Flatten POW sub-sections**

Replace the three separate `SubSection` groups (Reference Workflows, Template Workflows, Instance Workflows) with a single sub-section header: **"Project Orchestration (POWs)"**.

Render all workflows as a flat list underneath. Each item displays:
- Workflow display name (left)
- `pow_class` badge: `ref` / `tpl` / `inst` (right-aligned, monospace, muted)
- Version in sublabel

Retain the "+ New" action button. Relocate it to the sub-section header for "Project Orchestration (POWs)". The create workflow flow (choose mode → pick reference → enter ID) remains unchanged in behavior.

**Step 1.2 — Flatten DCW sub-section**

Replace the category-grouped Document Workflows rendering with a flat alphabetical list under sub-section header: **"Document Creation (DCWs)"**.

Each item displays:
- Document type display name (left)
- Version badge: `v1.4.0` (right-aligned, monospace, muted)

Remove category headers (intake, architecture, planning, other). Items are listed alphabetically by `display_name`.

**Step 1.3 — Add sub-section dot indicators**

Each sub-section header gets a small colored dot prefix:
- Green dot (CSS: `var(--state-success-text)` or equivalent): Project Orchestration (POWs)
- Blue dot (CSS: `var(--accent-blue)` or new variable): Document Creation (DCWs)

These dots are decorative indicators, not interactive elements.

**Step 1.4 — Collapse Building Blocks item lists**

Current state: Interactions and Schemas sub-sections expand to show full document type lists (duplicating the DCW listing).

Target state: Replace expandable sub-sections with **single-line clickable items** showing count badges:

```
BUILDING BLOCKS
  ● Roles           3
  ● Interactions     7
  ● Schemas          7
  ● Templates        4
```

Each item is a single `ItemButton` (or equivalent):
- Roles: count of `roles.length`. Click selects the first role (existing behavior: opens RoleEditor).
- Interactions: count of `documentTypes.length`. Click selects the first document type with `docTypeSource='task'` (existing behavior: opens PromptEditor on task_prompt tab).
- Schemas: count of `documentTypes.length`. Click selects the first document type with `docTypeSource='schema'` (existing behavior: opens PromptEditor on schema tab).
- Templates: count of `templates.length`. Click selects the first template (existing behavior: opens TemplateEditor).

**Behavioral note:** When clicking Interactions or Schemas, the left rail visually indicates which Building Block category is active. Users navigate between individual interactions/schemas by selecting DCWs in the Document Creation section and using the editor tab bar dropdowns.

**Step 1.5 — Building Blocks dot colors**

Each Building Block item gets a colored dot prefix:
- Purple: Roles
- Amber (`var(--action-primary)`): Interactions
- Blue: Schemas
- Green: Templates

**Step 1.6 — Governance section**

Keep existing Governance section. Add "Git Status" as a visible item if workspace state is available. Display dirty file count badge when applicable (e.g., `2 dirty` in amber).

### Phase 2: Editor Tab Bar Redesign

Target: `spa/src/components/admin/PromptEditor.jsx`

**Step 2.1 — Create TabDropdown component**

Create `spa/src/components/admin/TabDropdown.jsx`:

Props:
- `label`: string — display text (e.g., "Generation")
- `items`: array of `{ id, label, viewOnly? }` — dropdown options
- `selectedId`: string | null — currently selected item ID within this group
- `onSelect`: function(id) — callback when item is clicked
- `isGroupActive`: boolean — whether any item in this group is currently selected

Behavior:
- Renders as a tab-sized button with `▾` chevron
- If `isGroupActive`, tab shows active styling (amber underline)
- Click toggles dropdown menu open/closed
- Click on dropdown item calls `onSelect(id)` and closes dropdown
- Click outside closes all open dropdowns
- Dropdown items that are `viewOnly` show "(view)" suffix in muted text

**Step 2.2 — Restructure tab bar rendering**

Replace the flat `promptKinds.map(...)` tab rendering with grouped structure:

```
[ Package ] [ Workflow ] [ Generation ▾ ] [ QA ▾ ] [ PGC ▾ ] [ Schema ]
```

Mapping:
- **Package** — static tab → `selectedKind = 'package'`
- **Workflow** — static tab → `selectedKind = 'workflow'` (hidden if no `workflow_ref`)
- **Generation ▾** — dropdown containing:
  - Role (view) → `selectedKind = 'role_prompt'`
  - Task → `selectedKind = 'task_prompt'`
  - Template (view) → `selectedKind = 'template'`
- **QA ▾** — dropdown containing:
  - Prompt → `selectedKind = 'qa_prompt'`
  - Template (view) → `selectedKind = 'qa_template'`
- **PGC ▾** — dropdown containing (hidden if no PGC artifacts):
  - Context → `selectedKind = 'pgc_context'`
  - Template (view) → `selectedKind = 'pgc_template'`
- **Schema** — static tab → `selectedKind = 'schema'`

The `selectedKind` state variable is unchanged. The dropdown is purely a visual reorganization of how `setSelectedKind` is invoked.

**Step 2.3 — Conditional tab visibility**

Preserve existing filtering logic from `promptKinds` useMemo:
- Workflow tab hidden when `!docType.workflow_ref`
- PGC dropdown hidden when document type has no PGC artifacts
- Generation dropdown items hidden when corresponding refs/artifacts don't exist

**Step 2.4 — Preserve all existing content behavior**

No changes to:
- Source/Resolved toggle logic
- View-only indicators for role/template tabs
- Schema JSON editor
- PackageEditor
- WorkflowEditorContent
- `usePromptEditor` hook behavior
- Artifact ID construction
- Validation result display

### Phase 3: Visual Polish

**Step 3.1 — Typography refinement**

Apply wireframe typography to new elements only (do not change existing element styles):
- Sub-section headers (POWs, DCWs): 10px, 500 weight, with colored dot
- Count badges: 9px, monospace, muted
- `pow_class` badges: 9px, monospace, muted
- Dropdown menu items: 12px, normal weight
- Tab dropdown chevron: 9px, reduced opacity

**Step 3.2 — Dropdown menu styling**

Add CSS for the tab dropdown menu:
- Background: `var(--bg-panel)`
- Border: `1px solid var(--border-panel)`
- Border-radius: 6px
- Box-shadow for depth
- Item hover state matches existing patterns
- Positioned below the tab, left-aligned to the tab

**Step 3.3 — Theme verification**

Verify all three themes render correctly. New CSS must use existing CSS variables. New variables permitted only for the sub-section dot colors if no suitable variable exists.

---

## Prohibited Actions

- Do NOT change any backend API endpoints or data models
- Do NOT change editor content areas or their rendering behavior
- Do NOT add new React hooks or API client methods
- Do NOT change the GitStatusPanel layout or workspace lifecycle
- Do NOT remove any existing functionality — this is a reorganization, not a reduction
- Do NOT change how `selectedKind`, `docTypeSource`, or `selectedDocType` state works internally
- Do NOT change the Create Workflow flow behavior (only its visual location)
- Do NOT create new CSS files — extend existing theme CSS
- Do NOT introduce external dependencies

---

## Verification Checklist

### Left Rail

- [ ] No "Reference Workflows" / "Template Workflows" / "Instance Workflows" sub-sections exist
- [ ] All workflows appear under "Project Orchestration (POWs)" with `pow_class` badge
- [ ] No category headers (intake, architecture, planning, other) appear in DCW list
- [ ] All document types appear under "Document Creation (DCWs)" in alphabetical order with version badge
- [ ] Building Blocks shows 4 single-line items: Roles, Interactions, Schemas, Templates
- [ ] Building Blocks items show count badges
- [ ] No expandable sub-lists under Interactions or Schemas
- [ ] Clicking a DCW item opens PromptEditor (same behavior as current)
- [ ] Clicking a POW item opens StepWorkflowEditor (same behavior as current)
- [ ] Clicking Roles opens RoleEditor (same behavior as current)
- [ ] Clicking Interactions opens PromptEditor on task_prompt tab (same behavior as current)
- [ ] Clicking Schemas opens PromptEditor on schema tab (same behavior as current)
- [ ] Clicking Templates opens TemplateEditor (same behavior as current)
- [ ] "+ New" workflow creation flow still works
- [ ] Selection highlighting (amber left border) works correctly across all sections

### Tab Bar

- [ ] DCW editor shows grouped tabs: Package, Workflow, Generation ▾, QA ▾, PGC ▾, Schema
- [ ] Workflow tab hidden when document type has no `workflow_ref`
- [ ] PGC dropdown hidden when document type has no PGC artifacts
- [ ] Generation dropdown reveals: Role (view), Task, Template (view)
- [ ] QA dropdown reveals: Prompt, Template (view)
- [ ] PGC dropdown reveals: Context, Template (view)
- [ ] Selecting a dropdown item loads the correct artifact content
- [ ] Source/Resolved toggle still works for editable prompt tabs
- [ ] View-only indicator still appears for Role, Template tabs
- [ ] Schema tab loads JSON editor (unchanged)
- [ ] Package tab loads PackageEditor (unchanged)
- [ ] Clicking outside a dropdown closes it

### Visual

- [ ] Industrial theme renders correctly
- [ ] Light theme renders correctly
- [ ] Blueprint theme renders correctly
- [ ] Sub-section dots display in correct colors
- [ ] Count and version badges display correctly
- [ ] Dropdown menus are positioned correctly and don't overflow viewport

---

## Definition of Done

1. All verification checklist items pass
2. No existing Admin Workbench functionality is lost or degraded
3. Left rail matches ADR-045 §7 composition hierarchy
4. Tab bar groups artifacts by Interaction Pass
5. All three themes render correctly
6. Human operator has visually verified the result against the approved wireframe

---

*End of Work Statement*
