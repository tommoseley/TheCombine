# WS-ADR-044-003: Composition-First Workbench Redesign

| | |
|---|---|
| **Status** | In Progress (Implementation Complete, Pending Verification) |
| **Date** | 2026-02-06 |
| **Scope** | Multi-commit |
| **Governing ADRs** | ADR-044 (Admin Workbench), ADR-045 (System Ontology) |
| **Governing Policies** | POL-WS-001 |

---

## Problem Statement

The current Admin Workbench left rail is organized as a flat inventory browser where **primitives** (roles, templates, schemas, fragments) compete with **compositions** (POWs, DCWs) for attention. This violates the architectural principle:

> Primitives should not compete with compositions for attention.

**Observed problems:**

1. **Cognitive noise** â€” User's eye is constantly pulled to artifacts they rarely need to edit
2. **Decision anxiety** â€” "Do I need to edit this role? That schema?" when the answer is usually no
3. **Wrong mental model** â€” Suggests the system is assembled bottom-up, when it's governed top-down
4. **Dual editing surfaces** â€” Gate Internals and Canvas compete for focus, violating the rule that only one locus of complexity may be editable at a time

The UI is exposing implementation detail. The user thinks in compositions (POWs, DCWs). The system executes in compositions. The UI should reflect this.

---

## Solution

Reorganize the Workbench around **Compositions, not Artifacts**:

| Component | Current | Proposed |
|-----------|---------|----------|
| Left Rail | Everything as peers | Compositions only (POWs, DCWs) |
| Building Blocks | Mixed into left rail | Secondary tray, collapsed by default |
| Right Panel | Competing with canvas | THE editing surface for selected node |
| Gate Internals | All expanded | Progressive disclosure, one pass at a time |

**Core principle**: The Workbench should be organized around what you're working on (compositions), not what exists (inventory).

---

## Governing References

- **ADR-044**: Admin Workbench â€” defines the three-panel layout
- **ADR-045 Â§7**: Left rail organized by abstraction level; Building Blocks contain reusable primitives
- **ADR-045**: Primitives (fragments, schemas) serve compositions; compositions are the primary work unit
- **POL-WS-001**: Work Statement execution standard

---

## Scope

### Included

- Restructure `DocTypeBrowser.jsx` to show only compositions
- Create new `BuildingBlocksTray.jsx` component
- Update `AdminWorkbench.jsx` layout for tray integration
- Enhance `NodePropertiesPanel.jsx` for single-expansion behavior
- Remove Building Blocks from left rail DOM

### Excluded

- No changes to Building Block data hooks (useAdminRoles, useAdminTemplates, etc.)
- No changes to Building Block editor components (RoleEditor, TemplateEditor, SchemaEditor)
- No changes to underlying data model or API
- No changes to workflow execution behavior
- No changes to Git status panel or workspace lifecycle

---

## Preconditions

1. WS-ADR-044-001 (Left Rail UX) complete âœ“
2. PGC composite gate internals implemented (session 2026-02-06) âœ“
3. Schema editor functional âœ“

---

## Procedure

### Phase 1: Left Rail â€” Compositions Only

**Target:** `spa/src/components/admin/DocTypeBrowser.jsx`

**Step 1.1 â€” Remove Building Blocks section**

Remove from left rail render:
- Roles section
- Templates section
- Schemas section
- Prompt Fragments section

Keep in left rail:
- **Project Orchestration (POWs)** â€” grouped by pow_class as currently implemented
- **Document Workflows (DCWs)** â€” flat alphabetical list with version badges
- **Governance** (Git Status) â€” unchanged

**Step 1.2 â€” Update section headers**

Left rail now shows:
```
PROJECT ORCHESTRATION
  â–¸ Reference (2)
  â–¸ Template (1)

DOCUMENT WORKFLOWS
  â€¢ Concierge Intake       v1.0.0
  â€¢ Project Discovery      v1.4.0
  â€¢ Technical Architecture v1.0.0
  ...

GOVERNANCE
  â— Git Status
```

The left rail answers exactly one question: **"What am I working on?"**

---

### Phase 2: Building Blocks Tray

**Target:** `spa/src/components/admin/BuildingBlocksTray.jsx` (new), `spa/src/components/admin/AdminWorkbench.jsx`

**Step 2.1 â€” Create BuildingBlocksTray component**

Create `spa/src/components/admin/BuildingBlocksTray.jsx`:

Props:
- `isOpen`: boolean â€” tray open state
- `onClose`: function â€” callback to close tray
- `roles`: array â€” role fragments
- `templates`: array â€” templates
- `schemas`: array â€” schemas
- `fragments`: object â€” prompt fragments by kind
- `onSelectRole`: function(role)
- `onSelectTemplate`: function(template)
- `onSelectSchema`: function(schema)
- `onSelectFragment`: function(fragment)
- `onCreateRole`: function
- `onCreateTemplate`: function
- `onCreateSchema`: function
- `onCreateFragment`: function(kind)

Render as slide-out drawer (right side or overlay):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BUILDING BLOCKS         [X] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¸ Prompt Fragments      23  â”‚
â”‚     [ All ] [ Roles ] ...   â”‚
â”‚     â€¢ technical_architect   â”‚
â”‚     â€¢ project_manager       â”‚
â”‚ â–¸ Templates              3  â”‚
â”‚     â€¢ document_generator    â”‚
â”‚     â€¢ qa_evaluator         â”‚
â”‚ â–¸ Schemas                7  â”‚
â”‚     â€¢ project_discovery    â”‚
â”‚     â€¢ concierge_intake     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+ New Prompt] [+ New...]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key behaviors:**
- Collapsed by default on page load
- Never auto-opens
- Only opened intentionally by user
- Click item â†’ opens editor, closes tray
- Close button or click-outside â†’ closes tray

**Step 2.2 â€” Add tray toggle button**

Add to `AdminWorkbench.jsx` header or toolbar:
- Icon button (ğŸ§± or gear/cog icon)
- Tooltip: "Building Blocks"
- Click toggles `isTrayOpen` state

**Step 2.3 â€” Integrate tray with layout**

Update `AdminWorkbench.jsx`:
- Add `isTrayOpen` state (default: false)
- Render `BuildingBlocksTray` as overlay or side panel
- Pass existing hooks data (roles, templates, schemas, fragments)
- Wire selection handlers to existing editor logic

---

### Phase 3: Single Editing Surface

**Target:** `spa/src/components/admin/workflow/NodePropertiesPanel.jsx`, `spa/src/components/admin/AdminWorkbench.jsx`

**Step 3.1 â€” Right panel becomes THE editor**

Clarify the mental model:
- **Canvas** = navigation + structure (clicking selects, doesn't open inline editor)
- **Right Panel** = the active editor for whatever is selected
- No competing editors

When a node is selected:
1. Canvas shows selection highlight (glow effect â€” already implemented)
2. Right panel populates with node properties
3. User edits in right panel only

**Step 3.2 â€” Remove any inline canvas editing**

If any inline node editing exists on canvas, remove it. All editing happens in right panel.

---

### Phase 4: Progressive Disclosure in Gate Internals

**Target:** `spa/src/components/admin/workflow/NodePropertiesPanel.jsx`

**Step 4.1 â€” Single-expansion behavior for PGC internals**

Update `CollapsibleSection` or PGC internals rendering:
- When Pass A expands, collapse Pass B (and vice versa)
- Entry section can expand/collapse independently
- Only one LLM pass visible in detail at a time

Implementation:
```jsx
const [expandedPass, setExpandedPass] = useState(null); // 'A' | 'B' | null

<CollapsibleSection
    title="Pass A: Question Generation"
    isOpen={expandedPass === 'A'}
    onToggle={() => setExpandedPass(expandedPass === 'A' ? null : 'A')}
>
```

**Step 4.2 â€” Gate-level properties always visible**

Ensure these are always visible (not in collapsible sections):
- Gate Kind dropdown
- Produces field
- Description

Only the internal passes (Pass A, Entry, Pass B) use progressive disclosure.

---

## Prohibited Actions

- Do NOT remove Building Blocks data fetching hooks
- Do NOT delete RoleEditor, TemplateEditor, SchemaEditor components
- Do NOT change the underlying API or data model
- Do NOT change workflow execution behavior
- Do NOT change how workspace-scoped CRUD works
- Do NOT change Git status panel functionality
- Do NOT introduce external dependencies

---

## Verification Checklist

### Phase 1 â€” Left Rail

- [ ] Left rail shows only POWs and DCWs
- [ ] No roles, templates, schemas, or fragments visible in left rail
- [ ] POW grouping by pow_class still works
- [ ] DCW selection still works
- [ ] Git Status section still visible under Governance

### Phase 2 â€” Building Blocks Tray

- [ ] Tray toggle button visible in workbench header/toolbar
- [ ] Clicking toggle opens tray
- [ ] Tray shows Prompt Fragments, Templates, Schemas sections
- [ ] Tray is collapsed by default on page load
- [ ] Selecting item in tray opens corresponding editor
- [ ] Tray closes after selection (or via close button)
- [ ] "+ New" buttons work for each Building Block type

### Phase 3 â€” Single Editing Surface

- [ ] Clicking canvas node populates right panel
- [ ] No inline editing on canvas
- [ ] Right panel is the only active editor

### Phase 4 â€” Progressive Disclosure

- [ ] PGC gate internals collapsed by default
- [ ] Expanding Pass A collapses Pass B
- [ ] Expanding Pass B collapses Pass A
- [ ] Entry section expands/collapses independently
- [ ] Gate-level properties (gate_kind, produces, description) always visible

### Visual

- [ ] Industrial theme renders correctly
- [ ] Light theme renders correctly
- [ ] Blueprint theme renders correctly
- [ ] Tray transition/animation is smooth
- [ ] No layout shift when tray opens

---

## Definition of Done

1. All verification checklist items pass
2. Left rail is dramatically simpler (compositions only)
3. Building Blocks accessible but not prominent
4. Single editing focus at any given time
5. No regression in existing functionality
6. Human operator has visually verified the result

---

## Rationale

This redesign aligns the UI with the architectural principles established in ADR-045:

1. **Compositions are primary** â€” POWs and DCWs are what users work on
2. **Primitives serve compositions** â€” Roles, templates, schemas exist to be plugged in, not edited constantly
3. **One focus at a time** â€” Eliminates cognitive competition between canvas and properties panel
4. **Progressive disclosure** â€” Complexity hidden until explicitly needed

The user should think in the same units the system executes. That's the definition of a good workbench.

---

*End of Work Statement*
