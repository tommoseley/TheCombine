# WS-ADR-045-001: Admin Workbench Left Rail Restructure and Schema Extraction

**Status:** Complete
**Created:** 2026-02-04
**Scope:** Multi-commit (frontend + config + backend)
**ADR:** ADR-045 (Accepted)

---

## Purpose

Implement ADR-045's taxonomy in the Admin Workbench by reorganizing the left rail from an artifact-type listing to an abstraction-level structure, adding Tasks as a first-class Building Block, and extracting schemas from document type packages into a standalone reusable location.

Extracted schemas enable reuse across DCWs and support AI-assisted tuning without conversational context.

---

## Governing References

- **ADR-045**: System Ontology -- Primitives, Composites, and Configuration Taxonomy
- **ADR-044**: Admin Workbench with Git-Canonical Document Configuration
- **ADR-031**: Canonical Schema Types
- **POL-WS-001**: Standard Work Statements

---

## Scope

### In Scope

- Restructure DocTypeBrowser.jsx to organize by abstraction level
- Add Tasks section to Building Blocks
- Extract schemas from document type packages to standalone `combine-config/schemas/`
- Update backend package loader to resolve standalone schemas
- Update document type packages to reference extracted schemas
- Update CLAUDE.md with ADR-045 taxonomy reference

### Out of Scope

- Making Interaction Passes configurable (ontological term only)
- Schema registry database changes (ADR-031 scope, already exists)
- New editor components (existing editors are reused)
- Governance section beyond Active Releases and Git Status (future work)

---

## Preconditions

- [x] ADR-045 accepted
- [x] Admin Workbench operational with DocTypeBrowser, PromptEditor, RoleEditor, TemplateEditor
- [x] Orchestration workflow editing functional (StepWorkflowEditor)
- [x] combine-config/ repository layout established (WS-044-09)

---

## Procedure

### Phase 1: Left Rail Restructure (Frontend)

**Goal:** Reorganize DocTypeBrowser.jsx from flat artifact lists to abstraction-level groups.

**Current structure:**
```
Document Types (flat list)
Roles (flat list)
Templates (flat list)
Workflows (flat list)
```

**Target structure:**
```
CONFIGURATION

> Production Workflows
    > Project Workflows        (POWs -- step-based orchestration)
    > Document Workflows       (DCWs -- graph-based document production)

> Building Blocks
    > Roles
    > Tasks
    > Schemas
    > Templates

> Governance
    > Active Releases
    > Git Status
```

**Files to modify:**
- `spa/src/components/admin/DocTypeBrowser.jsx` -- restructure sections, add collapsible groups
- `spa/src/api/adminClient.js` -- add endpoints for tasks and schemas if needed
- `spa/src/hooks/` -- add hooks for fetching tasks and schemas if needed

**Steps:**
1. Rename "Document Types" section to "Document Workflows" under a "Production Workflows" group
2. Move orchestration workflows under "Project Workflows" in the same group
3. Create "Building Blocks" group containing Roles, Tasks, Schemas, Templates
4. Move Git Status and Active Releases into a "Governance" group
5. Each top-level group is collapsible; Production Workflows expanded by default

**Verification:**
- Left rail renders three groups: Production Workflows, Building Blocks, Governance
- All existing navigation still works (selecting a document type opens PromptEditor, selecting a role opens RoleEditor, etc.)
- Tasks section lists task prompts from document type packages
- Schemas section lists schemas from document type packages (or standalone location)
- Schemas open in existing JSON viewer (read-only for MVP)

---

### Phase 2: Tasks as Building Blocks (Frontend + Backend)

**Goal:** Surface task prompts as independently browsable items in the Building Blocks section.

Task prompts currently live inside document type packages at `combine-config/document_types/{type}/releases/{ver}/prompts/task.prompt.txt`. They are not independently listed.

**Approach:** The backend already loads document type packages. Expose a lightweight endpoint (or derive from existing data) that lists task prompts with their parent document type context.

**Steps:**
1. Add backend endpoint or extend existing workbench endpoint to return task prompt listing (doc_type_id, version, task_prompt path)
2. Add frontend hook to fetch task list
3. Add Tasks section in Building Blocks that lists tasks with their parent document type. Tasks are displayed as `{task_name} (from {document_type})` to prevent the misconception that tasks are globally reusable today.
4. Clicking a task navigates to the PromptEditor's Task tab for that document type

**Verification:**
- Tasks section shows one entry per document type that has a task prompt, labeled with parent context
- Clicking a task opens the correct PromptEditor tab
- No new data model required -- tasks are a view over existing document type packages

---

### Phase 3: Schema Extraction (Config + Backend)

**Goal:** Extract schemas from document type packages into standalone `combine-config/schemas/` for cross-DCW reuse.

**Current location:** `combine-config/document_types/{type}/releases/{ver}/schemas/output.schema.json`

**Target location:** `combine-config/schemas/{schema_name}/releases/{ver}/schema.json`

**Steps:**
1. Create `combine-config/schemas/` directory structure
2. For each existing document type with a schema:
   - Copy schema to `combine-config/schemas/{doc_type_id}/releases/{ver}/schema.json`
   - Update `package.yaml` to add a `schema_ref` field pointing to the standalone schema (e.g., `schema:project_discovery:1.4.0`)
   - Retain the packaged `schemas/output.schema.json` as a symlink or remove it (TBD based on backward compatibility needs)
3. Update `_active/active_releases.json` to include schema entries if needed
4. Update `app/config/package_loader.py` to resolve `schema_ref` from standalone location
5. Ensure existing resolution still works during transition (dual-read: check standalone first, fall back to packaged)

**Guardrails (per ADR-045 Section 8):**
- Schema extraction MUST preserve semantic identity
- Extraction MUST include a reference update in the document type package
- Breaking schema changes require major version bump

**Verification:**
- Schemas load from standalone location
- Document type packages reference schemas via `schema_ref`
- Existing functionality (preview, validation) works with extracted schemas
- Schemas section in Building Blocks lists standalone schemas

---

### Phase 4: CLAUDE.md and Documentation Update

**Goal:** Reference ADR-045 taxonomy in project bootstrap documentation.

**Steps:**
1. Add ADR-045 to the Governing ADRs table in CLAUDE.md
2. Add a brief taxonomy reference section to CLAUDE.md (primitives, composites, ontological terms)
3. Update WS-INVENTORY.md with this work statement

**Verification:**
- CLAUDE.md references ADR-045
- New AI sessions see the taxonomy in their bootstrap context

---

## Prohibited Actions

- Creating Interaction Pass as a configurable artifact or database entity
- Moving schemas without preserving semantic identity (no schema ID changes)
- Removing backward compatibility for packaged schemas before all consumers are migrated
- Adding new editor components where existing ones can be reused (Reuse-First Rule)
- Introducing new architectural concepts not defined in ADR-045

---

## Verification Checklist

- [x] Left rail shows three abstraction-level groups (Production Workflows, Building Blocks, Governance)
- [x] Document Workflows and Project Workflows are visually separated
- [x] Tasks section lists all task prompts and navigates to correct editor
- [x] Schemas section lists all schemas (standalone and/or packaged)
- [x] At least one schema extracted to `combine-config/schemas/` and referenced by its document type package
- [x] Package loader resolves standalone schema references
- [x] All existing navigation paths still work
- [x] CLAUDE.md references ADR-045 taxonomy
- [x] WS-INVENTORY.md updated

---

## Definition of Done

- Left rail reorganized per ADR-045 Section 7
- Tasks and Schemas are browsable as Building Blocks
- At least one schema extracted to standalone location with reference update
- Backend resolves both standalone and packaged schemas (transition support)
- CLAUDE.md and WS-INVENTORY.md updated
- No regressions in existing workbench functionality

---

## Dependencies

| Phase | Dependency |
|-------|------------|
| Phase 1: Left Rail | None (can start immediately) |
| Phase 2: Tasks | Phase 1 (needs Building Blocks group to exist) |
| Phase 3: Schema Extraction | Phase 1 (needs Schemas section to exist) |
| Phase 4: Documentation | Phases 1-3 complete |

Phases 2 and 3 can proceed in parallel after Phase 1.

---

*End of WS-ADR-045-001*
