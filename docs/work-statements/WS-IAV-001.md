# WS-IAV-001 IA Verification — Phase 1.1 Schema Shape Compliance Fix

Parent Standalone (no WP — skill fix)
Objective Fix the ia-verification skill so Phase 1.1 mechanically verifies that every required field in the governing schema is present and populated in the implementation artifact (document JSON). Currently Phase 1.1 does not actually diff schema required fields against document content, allowing missing-field violations to pass silently.

Depends on None

---

## Context

The IA verification skill was run against WP-WB-001 and produced a PASS verdict. However, the Implementation Plan document generated by the IP workflow has multiple fields defined in the IP JSON schema that are missing from the actual document JSON. Phase 1.1 (Schema Shape Compliance) did not report this.

This means Phase 1.1 is not performing the check it claims to perform. The skill text says

 Do persisted documents contain all required fields Are field types correct

But CC did not mechanically diff the schema's `required[]` and `properties{}` against the actual document fields.

---

## Scope

In scope
- Update `.claudeskillsia-verificationSKILL.md` Phase 1.1 to add explicit, mechanical instructions for schema-to-document field diffing
- The diff must be bidirectional
  - Fields in schema `required[]` but absent from document → FAIL (missing required field)
  - Fields in schema `properties{}` but absent from document → finding (missing optional field, severity LOW unless business-critical)
  - Fields in document but absent from schema `properties{}` → finding (undeclared field, severity MEDIUM — potential schema drift or `additionalProperties` violation)
- Instructions must tell CC exactly how to perform the diff (not just verify fields match)
- After updating the skill, re-run IA verification against the Implementation Plan document for the AI Portfolio Agent project to validate the fix catches the known missing fields

Out of scope
- Fixing the IP document itself (let the re-run findings drive that)
- Fixing the IP generation prompt (separate work)
- Changes to any other Phase of the skill
- Changes to the pressure-test skill

---

## Steps

### Step 1 Read the current skill

Read `.claudeskillsia-verificationSKILL.md`, specifically Phase 1.1.

### Step 2 Read the IP schema

Find the implementation_plan schema in `combine-configschemas` and extract
- `required[]` array
- `properties{}` keys at every nesting level
- Any `additionalProperties` constraints

### Step 3 Update Phase 1.1

Replace the current Phase 1.1 bullet list with explicit mechanical instructions

```
## 1.1 Schema Shape Compliance

For every schema governing a verified artifact

1. Load the schema JSON. Extract `required[]` and all `properties{}` keys at every nesting level.
2. Load the artifact JSON (the actual persisted document).
3. Perform a bidirectional field diff

   a) REQUIRED FIELD CHECK
      For each field in schema `required[]`
      - Is the field present in the document If NO → FAIL
      - Is the field non-null and non-empty If nullempty and schema does not allow null → FAIL
      - Is the field the correct type per schema If NO → FAIL

   b) OPTIONAL FIELD CHECK
      For each field in schema `properties{}` that is NOT in `required[]`
      - Is the field present in the document If NO → finding (LOW optional field absent)

   c) UNDECLARED FIELD CHECK
      For each field in the document
      - Is the field declared in schema `properties{}` If NO → finding (MEDIUM undeclared field — potential additionalProperties violation)

   d) NESTED OBJECT CHECK
      For each field that is type object with its own `properties{}`
      - Recurse steps a-c into the nested schema definition
      For each field that is type array with `items` containing `properties{}`
      - Verify at least one array element exists (if required)
      - Recurse steps a-c into the items schema for each element

4. Report format per field
   - Field path (dot notation, e.g., `plan_summary.overall_intent`)
   - Schema requirement (requiredoptional)
   - Document state (presentabsentnullwrong-type)
   - Verdict (PASSFAILfinding)
```

### Step 4 Re-run against IP document

Run the updated ia-verification skill against the AI Portfolio Agent Implementation Plan document
- Artifact the IP document JSON (find it in the project's document store or `data` directory)
- Authority the implementation_plan schema from `combine-configschemasimplementation_plan`

Write the report to `docsaudits2026-03-01-ia-verification-ip-portfolio-agent.md`.

---

## Verification

- [ ] Phase 1.1 in the skill now contains explicit field-diff instructions (not just verify fields match)
- [ ] The diff is bidirectional (missing required, missing optional, undeclared)
- [ ] The diff recurses into nested objects and arrays
- [ ] Re-run against IP document produces findings for the known missing fields
- [ ] Report written to `docsaudits`

---

## Prohibited

- Do not fix the IP document — only report the findings
- Do not modify any other Phase of the skill
- Do not modify the IP generation prompt
- Do not add runtime code — this is a skill text update only
