{% extends "base.html" %}

{% block main %}
<div class="flex w-full h-full">
  <!-- LEFT: Sidebar (like ChatGPT / Claude) -->
  <aside class="w-64 border-r bg-white flex flex-col">
    <div class="px-4 py-3 border-b flex items-center justify-between">
      <span class="text-xs font-semibold tracking-wide text-slate-600">
        Workspaces
      </span>
      <a href="/workspaces" class="text-[11px] text-blue-600 hover:underline">
        All
      </a>
    </div>

    <div class="flex-1 overflow-y-auto text-sm">
      {% for ws in sidebar_workspaces %}
        <a
          href="/workspaces/{{ ws.id }}"
          class="block px-4 py-2 truncate
                 {% if ws.id == workspace.id %}
                   bg-slate-100 font-semibold
                 {% else %}
                   hover:bg-slate-50
                 {% endif %}"
        >
          {{ ws.name }}
        </a>
      {% endfor %}
    </div>

    <div class="p-3 border-t">
      <a
        href="/workspaces/new"
        class="w-full inline-flex items-center justify-center
               rounded-md border border-slate-300 text-xs py-1.5
               hover:bg-slate-50"
      >
        + New workspace
      </a>
    </div>
  </aside>

  <!-- CENTER: Conversation / pipeline controls -->
  <section class="flex-1 border-r flex flex-col bg-slate-50">
    <div class="px-4 py-3 border-b bg-white flex items-center justify-between">
      <div>
        <h1 class="text-sm font-semibold text-slate-800">
          {{ workspace.name }}
        </h1>
        <p class="text-xs text-slate-500">
          {{ workspace.description or "No description yet" }}
        </p>
        <p class="mt-1 text-xs text-emerald-700">
          Stage:
          {% if pipeline_state %}
            {{ pipeline_state.stage }}
          {% else %}
            not_started
          {% endif %}
        </p>
      </div>

      <div class="space-x-2">
        <!-- Example: start / next button; wire to your existing route -->
        <form
          method="post"
          action="/workspaces/{{ workspace.id }}/pipeline/advance"
          hx-post="/workspaces/{{ workspace.id }}/pipeline/advance"
          hx-target="#conversation"
          hx-swap="beforeend"
          class="inline"
        >
          <button
            type="submit"
            class="inline-flex items-center px-3 py-1.5 rounded-md
                   bg-slate-900 text-xs text-white hover:bg-slate-800"
          >
            Next step
          </button>
        </form>
      </div>
    </div>

    <!-- Conversation stream -->
    <div id="conversation" class="flex-1 overflow-y-auto p-4 text-sm">
      <p class="text-xs text-slate-500">
        Conversation with PM / Architect / BA agents will appear here.
      </p>
      <!-- Later: SSE / HTMX snippets append here -->
    </div>
  </section>

  <!-- RIGHT: Documents list -->
  <aside class="w-80 bg-white flex flex-col">
    <div class="px-4 py-3 border-b">
      <div class="text-xs font-semibold text-slate-600 tracking-wide">
        Documents
      </div>
      <div class="text-[11px] text-slate-400 mt-1">
        Generated & approved canonical artifacts
      </div>
    </div>

    <div class="flex-1 overflow-y-auto">
      {% if documents %}
        {% for doc in documents %}
          <div class="px-4 py-3 border-b text-xs">
            <div class="flex items-center justify-between">
              <span class="uppercase tracking-wide text-[10px] text-slate-500">
                {{ doc.doc_type }}
              </span>
              <span class="text-[10px] text-slate-400">
                {{ doc.status }} Â· v{{ doc.schema_version }}
              </span>
            </div>
            <div class="mt-1 text-[11px] text-slate-600 truncate">
              {{ doc.created_at }}
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="px-4 py-3 text-[11px] text-slate-500">
          No canonical documents yet. Once the PM / Architect / BA flows run,
          their outputs will show up here.
        </p>
      {% endif %}
    </div>
  </aside>
</div>
{% endblock %}
