{
  "schema_version": "workflow.v1",
  "workflow_id": "software_product_development",
  "revision": "wfrev_2026_01_02_a",
  "effective_date": "2026-01-02",
  "name": "Software Product Development",
  "description": "End-to-end workflow for software product creation from discovery through implementation",

  "scopes": {
    "project": { "parent": null },
    "epic": { "parent": "project" },
    "story": { "parent": "epic" }
  },

  "document_types": {
    "project_discovery": {
      "name": "Project Discovery",
      "scope": "project",
      "may_own": [],
      "acceptance_required": false
    },
    "epic_backlog": {
      "name": "Epic Backlog",
      "scope": "project",
      "may_own": ["epic"],
      "collection_field": "epics",
      "acceptance_required": true,
      "accepted_by": ["pm"]
    },
    "project_architecture": {
      "name": "Project Technical Architecture",
      "scope": "project",
      "may_own": [],
      "acceptance_required": true,
      "accepted_by": ["architect"]
    },
    "epic_architecture": {
      "name": "Epic Technical Architecture",
      "scope": "epic",
      "may_own": [],
      "acceptance_required": false
    },
    "story_backlog": {
      "name": "Story Backlog",
      "scope": "epic",
      "may_own": ["story"],
      "collection_field": "stories",
      "acceptance_required": true,
      "accepted_by": ["pm", "ba"]
    },
    "story_implementation": {
      "name": "Story Implementation",
      "scope": "story",
      "may_own": [],
      "acceptance_required": false
    }
  },

  "entity_types": {
    "epic": {
      "name": "Epic",
      "parent_doc_type": "epic_backlog",
      "creates_scope": "epic"
    },
    "story": {
      "name": "Story",
      "parent_doc_type": "story_backlog",
      "creates_scope": "story"
    }
  },

  "steps": [
    {
      "step_id": "discovery",
      "role": "Technical Architect 1.0",
      "task_prompt": "Project Discovery v1.0",
      "produces": "project_discovery",
      "scope": "project",
      "inputs": []
    },
    {
      "step_id": "epic_backlog",
      "role": "Project Manager 1.0",
      "task_prompt": "Epic Backlog v1.0",
      "produces": "epic_backlog",
      "scope": "project",
      "inputs": [
        { "doc_type": "project_discovery", "scope": "project" }
      ]
    },
    {
      "step_id": "project_architecture",
      "role": "Technical Architect 1.0",
      "task_prompt": "Technical Architecture v1.0",
      "produces": "project_architecture",
      "scope": "project",
      "inputs": [
        { "doc_type": "project_discovery", "scope": "project" },
        { "doc_type": "epic_backlog", "scope": "project" }
      ]
    },
    {
      "step_id": "per_epic",
      "iterate_over": {
        "doc_type": "epic_backlog",
        "collection_field": "epics",
        "entity_type": "epic"
      },
      "scope": "epic",
      "steps": [
        {
          "step_id": "epic_architecture",
          "role": "Technical Architect 1.0",
          "task_prompt": "Epic Architecture v1.0",
          "produces": "epic_architecture",
          "scope": "epic",
          "inputs": [
            { "doc_type": "project_architecture", "scope": "project" },
            { "entity_type": "epic", "scope": "epic", "context": true }
          ]
        },
        {
          "step_id": "story_backlog",
          "role": "Business Analyst 1.0",
          "task_prompt": "Story Backlog v1.0",
          "produces": "story_backlog",
          "scope": "epic",
          "inputs": [
            { "entity_type": "epic", "scope": "epic", "context": true },
            { "doc_type": "epic_architecture", "scope": "epic", "context": true },
            { "doc_type": "project_architecture", "scope": "project", "required": false }
          ]
        },
        {
          "step_id": "per_story",
          "iterate_over": {
            "doc_type": "story_backlog",
            "collection_field": "stories",
            "entity_type": "story"
          },
          "scope": "story",
          "steps": [
            {
              "step_id": "implementation",
              "role": "Developer 1.0",
              "task_prompt": "Story Implementation v1.0",
              "produces": "story_implementation",
              "scope": "story",
              "inputs": [
                { "entity_type": "story", "scope": "story", "context": true },
                { "doc_type": "epic_architecture", "scope": "epic" }
              ]
            }
          ]
        }
      ]
    }
  ]
}
