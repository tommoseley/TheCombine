{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "architecture_id": "workbench-canonical-v1.3",
  "version": "1.3",
  "previous_version": "1.2",
  "status": "superseded",
  "created_date": "2024-11-01",
  "updated_date": "2024-11-29",
  "owner": "Architect",
  "revision_notes": "Added Workforce architecture with multi-agent collaboration. Defined Developer Worker, Developer Mentor, and Program Orchestrator roles. Established artifact-driven workflows and quality gates.",
  
  "system_overview": {
    "description": "Workbench AI is a development environment where a coordinated Workforce of AI roles (PM, BA, Architect, Developers, Mentors, QA) collaboratively delivers working software through structured workflows and canonical artifacts.",
    "core_principles": [
      "Separation of Concerns: Each role has distinct responsibilities with clear boundaries",
      "Artifact-Driven Workflow: Roles communicate via structured JSON artifacts, not ad-hoc conversation",
      "Single Source of Truth: Canonical documents define requirements, architecture, and backlog",
      "Read-Only AI Access: AI roles propose changes via JSON; only backend touches filesystem/git",
      "Incremental Delivery: Work proceeds in testable increments with quality gates",
      "Multi-Agent Collaboration: Multiple workers propose solutions independently"
    ],
    "architectural_patterns": [
      "Event-Driven Orchestration: Orchestrator dispatches work to roles based on ticket state",
      "Multi-Agent Collaboration: Multiple Developer Workers propose solutions independently",
      "Review & Integration: Developer Mentor synthesizes proposals into canonical implementation",
      "Branch-Based Development: workforce-sandbox → main via PR with automated tests"
    ]
  },
  
  "workforce_architecture": {
    "description": "Multi-agent AI workforce for collaborative software development",
    "epic_id": "WORKFORCE-001",
    "roles": {
      "product_manager": {
        "responsibilities": [
          "Define Epics and stories",
          "Break down requirements",
          "Define acceptance criteria",
          "Prioritize backlog"
        ],
        "outputs": ["Epic JSON", "Story definitions", "Backlog prioritization"]
      },
      "architect": {
        "responsibilities": [
          "Review Epic for architectural feasibility",
          "Design technical architecture",
          "Define integration points",
          "Maintain Canonical Architecture"
        ],
        "outputs": ["Architecture design", "Technical feasibility assessment", "Canonical Architecture updates"]
      },
      "business_analyst": {
        "responsibilities": [
          "Define operational criteria",
          "Generate BA Addendum (quality models, test coverage, approval rules)",
          "Define rework communication contracts",
          "Specify human approval rules"
        ],
        "outputs": ["BA Addendum JSON with 5 operational models"]
      },
      "developer_worker": {
        "responsibilities": [
          "Receive WORK-* ticket assignments",
          "Propose implementation as Proposal JSON",
          "Include code changes, test plan, risk assessment",
          "Work independently (multiple Developers may work on same ticket)"
        ],
        "outputs": ["Proposal JSON with code changes, tests, risks"]
      },
      "developer_mentor": {
        "responsibilities": [
          "Review Developer proposals",
          "Synthesize best ideas from multiple proposals",
          "Produce canonical CommitPlan",
          "Ensure quality gates met",
          "Request rework if needed",
          "Coordinate with /workforce/commit backend"
        ],
        "outputs": ["CommitPlan JSON", "IntegrationNotes JSON", "Rework requests"]
      },
      "program_orchestrator": {
        "responsibilities": [
          "Route Epics through PM → Architect → BA workflow",
          "Consolidate Epic outputs into canonical_epic.json",
          "Coordinate multi-role workflows",
          "Assign WORK-* tickets to Developers"
        ],
        "outputs": ["canonical_epic.json", "Ticket assignments", "Workflow coordination"]
      }
    },
    "multi_agent_collaboration_pattern": {
      "description": "Multiple Developer Workers independently propose solutions; Developer Mentor synthesizes",
      "ticket_execution_flow": [
        "1. Orchestrator assigns WORK-* ticket to Developer(s)",
        "2. Developer(s) independently generate Proposal JSON",
        "3. Developer Mentor reviews all proposals",
        "4. Developer Mentor synthesizes CommitPlan",
        "5. CommitPlan sent to /workforce/commit backend",
        "6. Backend executes commit and creates PR"
      ],
      "developer_deployment_tiers": {
        "simple_tickets": {
          "description": "Single Developer Worker",
          "criteria": "Well-defined, low risk, isolated changes"
        },
        "medium_tickets": {
          "description": "2-3 Developer Workers",
          "criteria": "Moderate complexity, some integration points"
        },
        "complex_tickets": {
          "description": "3-5 Developer Workers",
          "criteria": "High complexity, significant architectural impact"
        }
      }
    },
    "proposal_quality_model": {
      "description": "Five-dimensional quality scoring for Developer proposals",
      "dimensions": {
        "technical_soundness": {
          "weight": 0.30,
          "min_score": 7,
          "criteria": ["Architectural alignment", "Design patterns", "Code structure"]
        },
        "test_coverage": {
          "weight": 0.25,
          "min_score": 8,
          "criteria": ["Test completeness", "Edge cases", "Integration tests"]
        },
        "code_quality": {
          "weight": 0.20,
          "min_score": 7,
          "criteria": ["Readability", "Maintainability", "Best practices"]
        },
        "risk_assessment": {
          "weight": 0.15,
          "min_score": 7,
          "criteria": ["Risk identification", "Mitigation strategies"]
        },
        "documentation": {
          "weight": 0.10,
          "min_score": 6,
          "criteria": ["Clear explanations", "Code comments", "API documentation"]
        }
      },
      "overall_quality_gate": 7.5,
      "rework_required_if_below": 7.0
    },
    "artifacts": {
      "epic_json": {
        "description": "Product Manager defines Epic structure",
        "fields": ["epic_id", "title", "description", "acceptance_criteria", "stories", "scope"]
      },
      "ba_addendum_json": {
        "description": "Business Analyst operational criteria",
        "models": [
          "proposal_quality_model",
          "test_coverage_model",
          "ticket_complexity_tiers",
          "rework_communication_contract",
          "human_approval_rules"
        ]
      },
      "canonical_epic_json": {
        "description": "Consolidated Epic with all references",
        "sections": ["epic_definition", "canonical_architecture_ref", "ba_addendum_ref", "orchestration_plan", "quality_models"]
      },
      "proposal_json": {
        "description": "Developer Worker implementation proposal",
        "fields": ["proposal_id", "ticket_id", "code_changes", "test_plan", "risk_assessment", "explanation"]
      },
      "commit_plan_json": {
        "description": "Developer Mentor canonical implementation plan",
        "fields": ["commit_plan_id", "ticket_id", "synthesized_changes", "test_strategy", "integration_notes", "quality_assessment"]
      }
    }
  },
  
  "repository_structure": {
    "description": "Project structure with Workforce integration",
    "structure": {
      "app": {
        "path": "app/",
        "description": "FastAPI application (unchanged)",
        "subdirectories": {
          "routers": "API routes (auth.py, repo_view.py)",
          "services": "Business logic (email_service.py, repo_reader.py)",
          "schemas": "Pydantic models",
          "models": "Database models"
        }
      },
      "workforce": {
        "path": "workforce/",
        "description": "AI workforce engine (new)",
        "subdirectories": {
          "orchestrator.py": "Main orchestrator for ticket execution",
          "roles": "AI role implementations (pm.py, architect.py, ba.py, developer.py, mentor.py)",
          "canon": "Canonical artifacts (architecture, BA templates, schemas)",
          "backlog": "Product backlog (backlog.json)"
        }
      },
      "data": {
        "path": "data/",
        "description": "Mutable runtime data (new)",
        "subdirectories": {
          "workbench.db": "SQLite database",
          "logs": "Application logs"
        }
      },
      "tests": {
        "path": "tests/",
        "description": "Test suite",
        "subdirectories": {
          "app": "Application tests",
          "workforce": "Workforce tests"
        }
      }
    }
  },
  
  "integration_contracts": {
    "developer_to_mentor_contract": {
      "description": "Contract between Developer Workers and Developer Mentor",
      "developer_output": {
        "format": "Proposal JSON",
        "required_fields": ["proposal_id", "ticket_id", "code_changes", "test_plan", "risk_assessment"],
        "quality_requirements": "Must meet minimum quality thresholds across all 5 dimensions"
      },
      "mentor_input": {
        "receives": "All Developer proposals for ticket",
        "context": ["BA Addendum quality models", "Canonical Architecture constraints"]
      },
      "mentor_output": {
        "format": "CommitPlan JSON",
        "contains": ["Synthesized code changes", "Validated test plan", "Integration notes", "Quality assessment"]
      },
      "rework_protocol": {
        "trigger": "Proposal quality score < 7.0",
        "action": "Mentor requests rework with clear feedback",
        "iteration": "Developer revises and resubmits"
      }
    },
    "mentor_to_backend_contract": {
      "description": "Developer Mentor sends CommitPlan to /workforce/commit backend",
      "mentor_output": "CommitPlan JSON",
      "backend_input": "CommitPlan JSON",
      "backend_operations": [
        "Execute file changes in workforce-sandbox branch",
        "Run tests and linting",
        "Create PR to main branch",
        "Report success/failure to Mentor"
      ]
    }
  },
  
  "tech_stack": {
    "language": "Python 3.11+",
    "framework": "FastAPI",
    "validation": "Pydantic",
    "database": "SQLite",
    "orm": "SQLAlchemy",
    "testing": "pytest",
    "ai_llm": "Anthropic Claude API (claude-sonnet-4-20250514)"
  },
  
  "architectural_decisions": [],
  
  "future_considerations": [
    "Epic Processing Pipeline for automated Epic creation",
    "Configuration management system",
    "Schema versioning for artifact evolution",
    "Pipeline status tracking and resume capability"
  ]
}
